<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#070709">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="IL NEWS">
<link rel="manifest" href="/manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Hebrew:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<title>IL NEWS â€” ×—×“×©×•×ª ×™×©×¨××œ</title>
<style>
:root{
  --ink:#070709;
  --ink2:#0d0d12;
  --ink3:#13131a;
  --surface:#1a1a24;
  --surface2:#20202c;
  --line:rgba(255,255,255,0.06);
  --line2:rgba(255,255,255,0.1);
  --text:#e8e8f0;
  --text2:#8080a0;
  --text3:#40405a;
  --red:#ff2d2d;
  --red2:#cc1111;
  --amber:#f59e0b;
  --green:#22c55e;
  --blue:#3b82f6;
  --r:14px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{background:var(--ink)}
body{
  font-family:'Noto Sans Hebrew',sans-serif;
  background:var(--ink);
  color:var(--text);
  max-width:480px;margin:0 auto;
  padding-bottom:76px;
  min-height:100vh;
  -webkit-font-smoothing:antialiased;
  position:relative;overflow-x:hidden;
}
::-webkit-scrollbar{display:none}

/* â”€â”€ ATMOSPHERIC BG â”€â”€ */
.atm{
  position:fixed;pointer-events:none;z-index:0;
  top:-30%;right:-20%;
  width:70vw;height:70vw;max-width:360px;max-height:360px;
  border-radius:50%;
  background:radial-gradient(circle,rgba(255,45,45,0.07) 0%,transparent 65%);
  animation:atm1 8s ease-in-out infinite;
}
.atm2{
  position:fixed;pointer-events:none;z-index:0;
  bottom:-20%;left:-20%;
  width:60vw;height:60vw;max-width:300px;max-height:300px;
  border-radius:50%;
  background:radial-gradient(circle,rgba(59,130,246,0.05) 0%,transparent 65%);
  animation:atm2 11s ease-in-out infinite;
}
@keyframes atm1{0%,100%{transform:translate(0,0) scale(1)}50%{transform:translate(-5%,5%) scale(1.1)}}
@keyframes atm2{0%,100%{transform:translate(0,0) scale(1)}50%{transform:translate(5%,-5%) scale(1.08)}}

/* â”€â”€ HEADER â”€â”€ */
#header{
  position:sticky;top:0;z-index:50;
  background:rgba(7,7,9,0.9);
  backdrop-filter:blur(24px);
  border-bottom:1px solid var(--line);
}

.h-brand{
  display:flex;justify-content:space-between;align-items:center;
  padding:11px 16px 9px;
}
.brand-left{display:flex;align-items:center;gap:10px}
.brand-mark{
  font-family:'JetBrains Mono',monospace;
  font-size:16px;font-weight:700;
  color:var(--red);
  letter-spacing:2px;
}
.brand-sep{width:1px;height:16px;background:var(--line2)}
.brand-name{
  font-size:13px;font-weight:600;color:var(--text2);
  letter-spacing:0.5px;
}
.brand-right{display:flex;align-items:center;gap:8px}
.live-chip{
  display:flex;align-items:center;gap:5px;
  background:rgba(255,45,45,0.12);
  border:1px solid rgba(255,45,45,0.3);
  border-radius:6px;padding:3px 8px;
  font-family:'JetBrains Mono',monospace;
  font-size:10px;font-weight:700;color:var(--red);
  letter-spacing:1px;
}
.pulse-dot{width:6px;height:6px;border-radius:50%;background:var(--red);animation:pdot 1.4s ease-in-out infinite}
@keyframes pdot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.3;transform:scale(0.7)}}
#clock{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--text2)}

/* â”€â”€ ALERT STRIP â”€â”€ */
#alert-strip{
  display:none;overflow:hidden;
  background:linear-gradient(90deg,rgba(255,45,45,0.18),rgba(204,17,17,0.12));
  border-bottom:1px solid rgba(255,45,45,0.25);
}
#alert-strip.on{display:block;animation:stripIn 0.3s ease}
@keyframes stripIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
.strip-inner{display:flex;align-items:center;gap:10px;padding:8px 16px}
.strip-icon{font-size:18px;animation:sicon 0.5s ease-in-out infinite alternate}
@keyframes sicon{from{transform:scale(1)}to{transform:scale(1.2)}}
.strip-content{flex:1}
.strip-title{font-size:12px;font-weight:800;color:#ff6b6b}
.strip-areas{font-size:11px;color:rgba(255,107,107,0.7);margin-top:1px}

/* â”€â”€ TICKER â”€â”€ */
.ticker-wrap{
  display:flex;align-items:center;gap:10px;
  padding:6px 16px;
  background:rgba(255,255,255,0.02);
  border-bottom:1px solid var(--line);
  overflow:hidden;
}
.ticker-tag{
  font-family:'JetBrains Mono',monospace;
  font-size:9px;font-weight:700;color:var(--amber);
  background:rgba(245,158,11,0.1);
  border:1px solid rgba(245,158,11,0.25);
  border-radius:4px;padding:2px 6px;
  white-space:nowrap;flex-shrink:0;letter-spacing:1px;
}
#ticker-text{
  font-size:12px;color:rgba(232,232,240,0.6);
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  flex:1;transition:opacity 0.4s;
  font-weight:400;
}

/* â”€â”€ TABS â”€â”€ */
.tabs{
  display:flex;
  background:var(--ink);
  border-bottom:1px solid var(--line);
}
.tab{
  flex:1;padding:10px 0;
  border:none;cursor:pointer;background:transparent;
  font-size:11px;font-weight:600;color:var(--text3);
  border-bottom:2px solid transparent;
  transition:all 0.18s;font-family:inherit;
  display:flex;align-items:center;justify-content:center;gap:5px;
}
.tab.on{color:var(--red);border-bottom-color:var(--red);font-weight:800}
.panel{display:none}.panel.on{display:block}

/* â”€â”€ STATUS ROW â”€â”€ */
.status-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:7px 14px;
  background:var(--ink2);
  border-bottom:1px solid var(--line);
}
#status-txt{font-size:10px;color:var(--text3);font-family:'JetBrains Mono',monospace}
#rfbtn{
  padding:4px 12px;border-radius:6px;
  background:rgba(255,45,45,0.1);border:1px solid rgba(255,45,45,0.2);
  color:var(--red);font-size:10px;cursor:pointer;font-weight:700;
  font-family:'JetBrains Mono',monospace;letter-spacing:0.5px;
  transition:all 0.15s;
}
#rfbtn:active{background:rgba(255,45,45,0.2)}

/* â”€â”€ SOURCE PILLS â”€â”€ */
.src-row{
  display:flex;gap:5px;padding:9px 14px;
  overflow-x:auto;scrollbar-width:none;
  border-bottom:1px solid var(--line);
  background:var(--ink2);
}
.spill{
  padding:4px 12px;border-radius:20px;
  border:1px solid var(--line2);
  cursor:pointer;background:transparent;
  color:var(--text3);font-size:10px;
  white-space:nowrap;flex-shrink:0;
  font-family:inherit;font-weight:600;
  transition:all 0.15s;
}
.spill.on{font-weight:800}

/* â”€â”€ NEWS CARDS â”€â”€ */
#news-list{padding:10px 12px}

.time-sep{
  display:flex;align-items:center;gap:8px;
  padding:4px 2px 10px;
  font-family:'JetBrains Mono',monospace;
  font-size:9px;color:var(--text3);letter-spacing:1px;
}
.time-sep-line{flex:1;height:1px;background:var(--line)}

.card{
  display:block;text-decoration:none;color:inherit;
  background:var(--ink2);
  border:1px solid var(--line);
  border-radius:var(--r);
  padding:13px 14px 12px;
  margin-bottom:6px;
  position:relative;overflow:hidden;
  transition:background 0.12s,border-color 0.12s,transform 0.1s;
}
.card:active{transform:scale(0.988);background:var(--ink3)}

/* glow line on right */
.card::after{
  content:'';
  position:absolute;top:12px;right:0;
  width:2px;height:calc(100% - 24px);
  border-radius:2px 0 0 2px;
  background:var(--src-c,var(--line2));
  opacity:0.7;
}

/* NEW card highlight */
.card.fresh{border-color:rgba(34,197,94,0.2)}
.card.fresh::before{
  content:'';position:absolute;top:0;left:0;right:0;bottom:0;
  background:linear-gradient(135deg,rgba(34,197,94,0.04),transparent 60%);
  pointer-events:none;border-radius:var(--r);
}

/* BREAKING top card */
.card.top{
  border-color:rgba(255,45,45,0.2);
  background:linear-gradient(135deg,rgba(255,45,45,0.06) 0%,var(--ink2) 50%);
}

.card-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px}
.src-badge{
  display:inline-flex;align-items:center;gap:4px;
  font-size:10px;font-weight:800;
  padding:2px 8px;border-radius:5px;
  white-space:nowrap;flex-shrink:0;
}
.card-time-row{display:flex;align-items:center;gap:5px;flex-shrink:0}
.card-time{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text3)}
.new-tag{
  background:var(--green);color:#000;
  font-size:8px;font-weight:900;
  padding:1px 5px;border-radius:3px;letter-spacing:0.5px;
}
.card-title{font-size:13.5px;font-weight:700;line-height:1.55;color:var(--text)}
.card.top .card-title{color:#ff8080}
.card-desc{font-size:11.5px;color:var(--text2);line-height:1.5;margin-top:5px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}

.empty-state{text-align:center;padding:52px 20px;color:var(--text3)}

/* â”€â”€ ALERTS PANEL â”€â”€ */
.a-wrap{padding:12px}

.oref-bar{
  display:flex;align-items:center;gap:10px;
  padding:10px 14px;
  background:var(--ink2);border:1px solid var(--line);
  border-radius:var(--r);margin-bottom:10px;
}
.oref-ind{
  width:10px;height:10px;border-radius:50%;flex-shrink:0;
  background:var(--green);
  box-shadow:0 0 0 0 rgba(34,197,94,0.4);
  animation:orefpulse 2s infinite;
}
.oref-ind.offline{background:var(--text3);box-shadow:none;animation:none}
.oref-ind.alert{background:var(--red);box-shadow:0 0 0 0 rgba(255,45,45,0.5);animation:redalert 1s infinite}
@keyframes orefpulse{0%{box-shadow:0 0 0 0 rgba(34,197,94,0.4)}70%{box-shadow:0 0 0 7px rgba(34,197,94,0)}100%{box-shadow:0 0 0 0 rgba(34,197,94,0)}}
@keyframes redalert{0%{box-shadow:0 0 0 0 rgba(255,45,45,0.6)}70%{box-shadow:0 0 0 10px rgba(255,45,45,0)}100%{box-shadow:0 0 0 0 rgba(255,45,45,0)}}
.oref-info{flex:1}
.oref-name{font-size:12px;font-weight:700;color:var(--text)}
.oref-detail{font-size:10px;color:var(--text3);margin-top:1px}
#oref-ts{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text3)}

#abox{
  border-radius:var(--r);padding:22px 18px;margin-bottom:10px;
  text-align:center;
  border:1px solid rgba(34,197,94,0.15);
  background:rgba(34,197,94,0.04);
  transition:all 0.3s;
}
#abox.danger{
  border-color:rgba(255,45,45,0.3);
  background:linear-gradient(135deg,rgba(255,45,45,0.1),rgba(204,17,17,0.06));
  animation:boxpulse 1.5s ease-in-out infinite;
}
@keyframes boxpulse{0%,100%{box-shadow:0 0 0 0 rgba(255,45,45,0.15)}50%{box-shadow:0 0 0 12px rgba(255,45,45,0)}}
#abox-icon{font-size:44px;margin-bottom:6px}
#abox-status{font-size:17px;font-weight:900;color:var(--green)}
#abox.danger #abox-status{color:#ff6b6b}
#abox-areas{font-size:13px;color:#ff8080;margin-top:8px;line-height:2;font-weight:700}
.abox-meta{font-size:9px;color:var(--text3);margin-top:8px;display:flex;align-items:center;justify-content:center;gap:6px;font-family:'JetBrains Mono',monospace}
.oref-chip{
  background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);
  border-radius:3px;padding:1px 5px;font-size:8px;color:var(--green);font-weight:700;
}

.sgrid{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:10px}
.scard{background:var(--ink2);border:1px solid var(--line);border-radius:var(--r);padding:13px 11px;text-align:center}
.scard-icon{font-size:24px;margin-bottom:4px}
.scard-lbl{font-size:10px;color:var(--text2)}
.scard-time{font-family:'JetBrains Mono',monospace;font-size:15px;font-weight:700;margin-top:5px}

.hist-hdr{font-size:9px;font-weight:800;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:7px;font-family:'JetBrains Mono',monospace}
.hcard{background:var(--ink2);border:1px solid var(--line);border-radius:10px;padding:10px 13px;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}
.hcard-city{font-size:12px;font-weight:700;color:var(--text)}
.hcard-type{font-size:10px;color:var(--text3);margin-top:2px}
.hcard-time{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;color:var(--amber)}

/* â”€â”€ SETTINGS â”€â”€ */
.s-wrap{padding:12px}
.s-section{margin-bottom:18px}
.s-hdr{font-size:9px;font-weight:800;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:7px;font-family:'JetBrains Mono',monospace}
.s-block{background:var(--ink2);border:1px solid var(--line);border-radius:var(--r);overflow:hidden}
.s-row{display:flex;align-items:center;justify-content:space-between;padding:13px 15px;border-bottom:1px solid var(--line)}
.s-row:last-child{border-bottom:none}
.s-row.col{flex-direction:column;align-items:flex-start;gap:9px}
.s-label{font-size:13px;font-weight:600;color:var(--text)}
.s-sub{font-size:10px;color:var(--text3);margin-top:2px}
.tog{width:44px;height:24px;border-radius:12px;background:var(--surface);border:1px solid var(--line2);cursor:pointer;position:relative;transition:all 0.2s;flex-shrink:0}
.tog.on{background:var(--green);border-color:var(--green)}
.tog::after{content:'';position:absolute;top:3px;right:3px;width:18px;height:18px;border-radius:50%;background:#fff;transition:all 0.2s;box-shadow:0 1px 4px rgba(0,0,0,0.3)}
.tog.on::after{right:23px}
.vol-sl{width:100%;cursor:pointer;accent-color:var(--red)}
.notif-btn{
  width:100%;padding:13px;border-radius:10px;
  background:rgba(59,130,246,0.1);border:1px solid rgba(59,130,246,0.25);
  color:#60a5fa;font-size:13px;font-weight:700;
  cursor:pointer;font-family:inherit;margin-bottom:8px;
  transition:all 0.15s;
}
.notif-btn:active{background:rgba(59,130,246,0.2)}
.test-btn{
  width:100%;padding:11px;border-radius:10px;
  background:rgba(255,45,45,0.08);border:1px solid rgba(255,45,45,0.2);
  color:var(--red);font-size:12px;font-weight:700;
  cursor:pointer;font-family:inherit;margin-top:6px;
  transition:all 0.15s;
}

/* â”€â”€ ALERT OVERLAY â”€â”€ */
#overlay{display:none;position:fixed;inset:0;z-index:999;background:rgba(0,0,0,0.85);backdrop-filter:blur(12px);align-items:center;justify-content:center}
#overlay.on{display:flex}
.o-modal{
  background:linear-gradient(145deg,#1a0a0a,#130505);
  border:1px solid rgba(255,45,45,0.4);
  border-radius:20px;padding:28px 22px;text-align:center;
  width:88%;max-width:340px;
  box-shadow:0 0 60px rgba(255,45,45,0.2),inset 0 1px 0 rgba(255,255,255,0.06);
  animation:omin 0.35s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes omin{from{transform:scale(0.85) translateY(20px);opacity:0}to{transform:scale(1) translateY(0);opacity:1}}
.o-type{font-size:13px;color:rgba(255,107,107,0.7);margin-top:4px;font-weight:500}
.o-areas{font-size:15px;color:#ff8080;margin-top:12px;line-height:2;font-weight:700}
.o-warn{
  margin-top:14px;padding:10px 14px;
  background:rgba(255,45,45,0.1);border:1px solid rgba(255,45,45,0.2);
  border-radius:8px;font-size:12px;font-weight:700;color:#ff6b6b;
}
.o-btn{
  margin-top:16px;width:100%;padding:13px;
  border-radius:10px;border:1px solid rgba(255,45,45,0.3);
  background:rgba(255,45,45,0.1);color:#ff8080;
  font-size:14px;font-weight:800;cursor:pointer;font-family:inherit;
  transition:all 0.15s;
}
.o-btn:active{background:rgba(255,45,45,0.25)}

/* â”€â”€ BOTTOM NAV â”€â”€ */
#bnav{
  position:fixed;bottom:0;left:50%;transform:translateX(-50%);
  width:100%;max-width:480px;z-index:100;
  background:rgba(7,7,9,0.96);
  border-top:1px solid var(--line);
  display:flex;backdrop-filter:blur(20px);
  padding-bottom:env(safe-area-inset-bottom);
}
.nbtn{
  flex:1;padding:10px 0;border:none;cursor:pointer;background:transparent;
  font-size:9px;font-weight:600;color:var(--text3);
  display:flex;flex-direction:column;align-items:center;gap:3px;
  font-family:inherit;position:relative;transition:color 0.15s;
  letter-spacing:0.5px;
}
.nbtn.on{color:var(--red);font-weight:800}
.nicon{font-size:20px;line-height:1}
.nbadge{position:absolute;top:7px;right:calc(50% - 15px);width:7px;height:7px;border-radius:50%;background:var(--green);border:2px solid var(--ink)}
.nbadge.danger{background:var(--red);animation:blink 0.9s infinite}

/* â”€â”€ UTILS â”€â”€ */
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.15}}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes spin{to{transform:rotate(360deg)}}
.spin{display:inline-block;animation:spin 0.6s linear infinite}
.empty-state{padding:52px 20px;text-align:center;color:var(--text3)}
</style>
</head>
<body>
<div class="atm"></div>
<div class="atm2"></div>

<!-- ALERT OVERLAY -->
<div id="overlay">
  <div class="o-modal">
    <div style="font-size:54px">ğŸš¨</div>
    <div style="font-size:22px;font-weight:900;color:#ff4040;margin-top:6px">××–×¢×§×”!</div>
    <div class="o-type" id="o-type"></div>
    <div class="o-areas" id="o-areas"></div>
    <div class="o-warn">âš ï¸ ×”×™×›× ×¡×• ×œ××¨×—×‘ ××•×’×Ÿ ××™×™×“×™×ª!</div>
    <button class="o-btn" onclick="closeOverlay()">×”×‘× ×ª×™ â€” × ×›× ×¡×ª×™ ×œ××¨×—×‘ ××•×’×Ÿ</button>
  </div>
</div>

<!-- HEADER -->
<div id="header">
  <div class="h-brand">
    <div class="brand-left">
      <span style="font-size:20px">ğŸ‡®ğŸ‡±</span>
      <div class="brand-mark">IL NEWS</div>
      <div class="brand-sep"></div>
      <div class="brand-name">×—×“×©×•×ª ×‘×–××Ÿ ×××ª</div>
    </div>
    <div class="brand-right">
      <div class="live-chip"><div class="pulse-dot"></div>LIVE</div>
      <div id="clock">--:--</div>
    </div>
  </div>
  <div id="alert-strip">
    <div class="strip-inner">
      <div class="strip-icon">ğŸš¨</div>
      <div class="strip-content">
        <div class="strip-title">××–×¢×§×” ×¤×¢×™×œ×”</div>
        <div class="strip-areas" id="strip-areas"></div>
      </div>
    </div>
  </div>
  <div class="ticker-wrap">
    <div class="ticker-tag">BREAKING</div>
    <div id="ticker-text">××ª×—×‘×¨ ×œ×¢×¨×•×¦×™×...</div>
  </div>
  <div class="tabs">
    <button class="tab on" onclick="goTab('news',this)">ğŸ“° ×—×“×©×•×ª</button>
    <button class="tab" onclick="goTab('alerts',this)">ğŸš¨ ××–×¢×§×•×ª</button>
    <button class="tab" onclick="goTab('settings',this)">âš™ï¸ ×”×’×“×¨×•×ª</button>
  </div>
</div>

<!-- NEWS -->
<div id="panel-news" class="panel on">
  <div class="status-row">
    <span id="status-txt"><span class="spin">âŸ³</span>&nbsp;×˜×•×¢×Ÿ...</span>
    <button id="rfbtn" onclick="loadNews(true)">âŸ³ REFRESH</button>
  </div>
  <div class="src-row" id="src-row"></div>
  <div id="news-list">
    <div class="empty-state"><div style="font-size:44px">ğŸ“¡</div><p style="margin-top:10px;font-size:13px;font-weight:600">××ª×—×‘×¨ ×œ×¢×¨×•×¦×™×...</p></div>
  </div>
</div>

<!-- ALERTS -->
<div id="panel-alerts" class="panel">
  <div class="a-wrap">
    <div class="oref-bar">
      <div class="oref-ind offline" id="oref-ind"></div>
      <div class="oref-info">
        <div class="oref-name">×¤×™×§×•×“ ×”×¢×•×¨×£ â€” oref.org.il</div>
        <div class="oref-detail">×‘×“×™×§×” ×›×œ 5 ×©× ×™×•×ª â€¢ × ×ª×•× ×™× ×¨×©××™×™×</div>
      </div>
      <div id="oref-ts">--:--:--</div>
    </div>

    <div id="abox">
      <div id="abox-icon">âœ…</div>
      <div id="abox-status">××™×Ÿ ××–×¢×§×•×ª ×›×¨×’×¢</div>
      <div id="abox-areas"></div>
      <div class="abox-meta">
        <span class="oref-chip">oref.org.il</span>
        <span>LIVE â€¢ 5s</span>
      </div>
    </div>

    <div class="sgrid">
      <div class="scard"><div class="scard-icon">ğŸƒ</div><div class="scard-lbl">×‘× ×™×™×Ÿ ×¨×’×™×œ</div><div class="scard-time" style="color:#f59e0b">90s</div></div>
      <div class="scard"><div class="scard-icon">ğŸ </div><div class="scard-lbl">×‘×™×ª ×¤×¨×˜×™</div><div class="scard-time" style="color:#f97316">60s</div></div>
      <div class="scard"><div class="scard-icon">ğŸŒ³</div><div class="scard-lbl">×©×˜×— ×¤×ª×•×—</div><div class="scard-time" style="color:var(--red)">30s</div></div>
      <div class="scard"><div class="scard-icon">ğŸš—</div><div class="scard-lbl">×¨×›×‘</div><div class="scard-time" style="color:#a78bfa">×¢×¦×•×¨</div></div>
    </div>

    <div class="hist-hdr">×”×™×¡×˜×•×¨×™×™×ª ××–×¢×§×•×ª ×”×™×•×</div>
    <div id="hist-list"><div style="color:var(--text3);font-size:11px;padding:10px 0">×˜×•×¢×Ÿ...</div></div>
  </div>
</div>

<!-- SETTINGS -->
<div id="panel-settings" class="panel">
  <div class="s-wrap">
    <div class="s-section">
      <div class="s-hdr">×”×ª×¨××•×ª</div>
      <button class="notif-btn" onclick="reqNotif()">ğŸ”” ×”×¤×¢×œ ×”×ª×¨××•×ª ×“×¤×“×¤×Ÿ</button>
      <div class="s-block">
        <div class="s-row"><div><div class="s-label">×¦×œ×™×œ ××–×¢×§×”</div><div class="s-sub">×¦×¤×™×¨×” ×›×©×™×© ××–×¢×§×” ×¤×¢×™×œ×”</div></div><div class="tog on" id="t-sound" onclick="tog('sound')"></div></div>
        <div class="s-row"><div><div class="s-label">×•×™×‘×¨×¦×™×”</div><div class="s-sub">×¨×˜×˜ ×—×–×§ ×‘××¦×‘ ××–×¢×§×”</div></div><div class="tog on" id="t-vib" onclick="tog('vib')"></div></div>
        <div class="s-row col"><div class="s-label">×¢×•×¦××ª ×¦×œ×™×œ</div><input type="range" min="0" max="100" value="80" class="vol-sl" id="vol" oninput="setV(this.value)"></div>
      </div>
      <button class="test-btn" onclick="testSound()">â–¶ ×‘×“×•×§ ×¦×œ×™×œ ××–×¢×§×”</button>
    </div>
    <div class="s-section">
      <div class="s-hdr">×¢×“×›×•× ×™×</div>
      <div class="s-block">
        <div class="s-row"><div><div class="s-label">×¨×¢× ×•×Ÿ ××•×˜×•××˜×™</div><div class="s-sub">×—×“×©×•×ª ×•××–×¢×§×•×ª ×›×œ 5 ×©× ×™×•×ª</div></div><div class="tog on" id="t-auto" onclick="tog('auto')"></div></div>
      </div>
    </div>
    <div style="text-align:center;padding:18px 0 6px;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text3);letter-spacing:1px">
      IL NEWS v2.3 â€¢ REAL-TIME<br>
      <span style="color:var(--text3)">ynet â€¢ walla â€¢ kan11 â€¢ ch12 â€¢ ch13 â€¢ ch14 â€¢ mako â€¢ maariv â€¢ idf</span>
    </div>
  </div>
</div>

<!-- BOTTOM NAV -->
<div id="bnav">
  <button class="nbtn on" id="nb-news" onclick="goTab('news',null)"><span class="nicon">ğŸ“°</span>×—×“×©×•×ª</button>
  <button class="nbtn" id="nb-alerts" onclick="goTab('alerts',null)"><div class="nbadge" id="abadge"></div><span class="nicon">ğŸš¨</span>××–×¢×§×•×ª</button>
  <button class="nbtn" id="nb-settings" onclick="goTab('settings',null)"><span class="nicon">âš™ï¸</span>×”×’×“×¨×•×ª</button>
</div>

<script>
// â”€â”€ SETTINGS
const ST=JSON.parse(localStorage.getItem('ilnews')||'{}');
const DEF={sound:true,vib:true,auto:true};
const gst=k=>k in ST?ST[k]:DEF[k];
const sst=(k,v)=>{ST[k]=v;localStorage.setItem('ilnews',JSON.stringify(ST))};
function tog(k){const v=!gst(k);sst(k,v);const e=document.getElementById('t-'+k);if(e)v?e.classList.add('on'):e.classList.remove('on');if(k==='auto')v?startAuto():stopAuto()}
['sound','vib','auto'].forEach(k=>{const e=document.getElementById('t-'+k);if(e)gst(k)?e.classList.add('on'):e.classList.remove('on')});

// â”€â”€ STATE
let items=[],src='all',alert=false,tickI=0,timer=null,vol=0.8,lastKey='',oFails=0,busy=false;

// â”€â”€ CLOCK
function clk(){const n=new Date();document.getElementById('clock').textContent=n.toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'})}
clk();setInterval(clk,1000);

// â”€â”€ TICKER
function rotateTicker(){
  if(!items.length)return;
  const el=document.getElementById('ticker-text');
  el.style.opacity='0';
  setTimeout(()=>{
    const it=items[tickI%Math.min(items.length,60)];
    if(it)el.textContent=it.sourceIcon+' '+it.title;
    el.style.opacity='1';tickI++;
  },400);
}
setInterval(rotateTicker,6000);

// â”€â”€ TABS
function goTab(tab,btn){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('on'));
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('on'));
  document.querySelectorAll('.nbtn').forEach(b=>b.classList.remove('on'));
  document.getElementById('panel-'+tab).classList.add('on');
  if(btn)btn.classList.add('on');
  const m={news:'nb-news',alerts:'nb-alerts',settings:'nb-settings'};
  if(m[tab])document.getElementById(m[tab]).classList.add('on');
}

// â”€â”€ CHANNELS
const CH={
  ynet:{n:'ynet',c:'#E8001E',i:'ğŸ“°'},
  ynet_war:{n:'ynet ××œ×—××”',c:'#b30000',i:'ğŸ”´'},
  walla:{n:'×•×•××œ×”',c:'#FF6B00',i:'ğŸ”¥'},
  walla_war:{n:'×•×•××œ×” ×‘×™×˜×—×•×Ÿ',c:'#cc5500',i:'âš”ï¸'},
  maariv:{n:'××¢×¨×™×‘',c:'#0891B2',i:'ğŸ—ï¸'},
  kan:{n:'×›××Ÿ 11',c:'#3b82f6',i:'ğŸ™ï¸'},
  ch12:{n:'×¢×¨×•×¥ 12',c:'#C8102E',i:'ğŸ“º'},
  ch13:{n:'×¢×¨×•×¥ 13',c:'#7C3AED',i:'ğŸ“¡'},
  ch14:{n:'×¢×¨×•×¥ 14',c:'#d97706',i:'ğŸ¦…'},
  mako:{n:'×××§×•',c:'#e11d48',i:'ğŸ¬'},
  idf:{n:'×“×•×‘×¨ ×¦×‘×',c:'#22c55e',i:'ğŸª–'},
};

// â”€â”€ SRC PILLS
function buildSrcRow(){
  const el=document.getElementById('src-row');
  const srcs=['all',...new Set(items.map(i=>i.source))];
  el.innerHTML='';
  srcs.forEach(id=>{
    const ch=id==='all'?{n:'×”×›×œ',c:'#e8e8f0',i:'ğŸŒ'}:(CH[id]||{n:id,c:'#808080',i:'ğŸ“°'});
    const b=document.createElement('button');
    b.className='spill'+(id===src?' on':'');
    b.textContent=ch.i+' '+ch.n;
    if(id===src){b.style.background=ch.c+'18';b.style.borderColor=ch.c+'50';b.style.color=ch.c}
    b.onclick=()=>{src=id;buildSrcRow();buildList()};
    el.appendChild(b);
  });
}

// â”€â”€ BUILD LIST
const seen=new Set();
function buildList(){
  const el=document.getElementById('news-list');
  const list=src==='all'?items:items.filter(x=>x.source===src);
  if(!list.length){el.innerHTML='<div class="empty-state"><div style="font-size:40px">ğŸ“­</div><p style="margin-top:8px;font-size:13px">××™×Ÿ ×›×ª×‘×•×ª</p></div>';return}
  el.innerHTML='';
  // time separator
  const sep=document.createElement('div');sep.className='time-sep';
  const t=new Date().toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'});
  sep.innerHTML=`<span class="time-sep-line"></span><span>×¢×“×›×•×Ÿ ${t}</span><span class="time-sep-line"></span>`;
  el.appendChild(sep);
  list.forEach((item,idx)=>{
    const ch=CH[item.source]||{n:item.source,c:'#808080',i:'ğŸ“°'};
    const isNew=!seen.has(item.id);
    const isTop=idx===0&&src==='all';
    const a=document.createElement('a');
    a.className='card'+(isTop?' top':isNew?' fresh':'');
    a.style.setProperty('--src-c',ch.c);
    a.href=item.link||'#';a.target='_blank';a.rel='noopener';
    a.style.animation=`fadeUp 0.2s ease ${Math.min(idx,16)*0.025}s both`;
    a.innerHTML=`
      <div class="card-head">
        <span class="src-badge" style="background:${ch.c}15;color:${ch.c}">${ch.i} ${ch.n}</span>
        <div class="card-time-row">
          <span class="card-time">${item.timeAgo}</span>
          ${isNew?'<span class="new-tag">NEW</span>':''}
        </div>
      </div>
      <div class="card-title">${item.title}</div>
      ${item.desc?`<div class="card-desc">${item.desc}</div>`:''}
    `;
    el.appendChild(a);
    seen.add(item.id);
  });
}

// â”€â”€ LOAD NEWS
async function loadNews(manual=false){
  if(busy&&!manual)return;busy=true;
  const btn=document.getElementById('rfbtn');
  const stxt=document.getElementById('status-txt');
  if(manual){btn.disabled=true;btn.innerHTML='<span class="spin">âŸ³</span>'}
  try{
    const r=await fetch('/api/news?t='+Date.now());
    const d=await r.json();
    if(d.items&&d.items.length){
      items=d.items;
      const t=new Date(d.updated).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
      stxt.innerHTML=`âœ“ ${t} &nbsp;â€¢&nbsp; ${d.total} ×›×ª×‘×•×ª`;
      buildSrcRow();buildList();rotateTicker();
    }
  }catch(e){if(manual)stxt.textContent='×©×’×™××”'}
  if(manual){btn.disabled=false;btn.textContent='âŸ³ REFRESH'}
  busy=false;
}
function startAuto(){stopAuto();if(gst('auto'))timer=setInterval(()=>loadNews(),5000)}
function stopAuto(){if(timer){clearInterval(timer);timer=null}}
startAuto();

// â”€â”€ SOUND
function setV(v){vol=v/100}
document.getElementById('vol').oninput=e=>setV(e.target.value);
function playAlarm(){
  if(!gst('sound'))return;
  try{
    const ctx=new(window.AudioContext||window.webkitAudioContext)();
    [[440,.12],[880,.12],[440,.12],[880,.12],[440,.12],[880,.12]].forEach(([f,d],i)=>{
      const o=ctx.createOscillator(),g=ctx.createGain();
      o.connect(g);g.connect(ctx.destination);
      o.type='sawtooth';o.frequency.value=f;
      const t=ctx.currentTime+i*0.17;
      g.gain.setValueAtTime(vol*.45,t);
      g.gain.exponentialRampToValueAtTime(.001,t+d);
      o.start(t);o.stop(t+d);
    });
  }catch(e){}
}
function testSound(){playAlarm();if(gst('vib')&&navigator.vibrate)navigator.vibrate([200,100,200])}
async function reqNotif(){
  if(!('Notification'in window)){alert('×”×“×¤×“×¤×Ÿ ×œ× ×ª×•××š ×‘×”×ª×¨××•×ª');return}
  const p=await Notification.requestPermission();
  alert(p==='granted'?'âœ… ×”×ª×¨××•×ª ×”×•×¤×¢×œ×•!':'âš ï¸ ×× × ××©×¨ ×”×¨×©××” ×‘×”×’×“×¨×•×ª ×”×“×¤×“×¤×Ÿ');
}

// â”€â”€ OREF STATUS UI
function setOrefUI(state){
  const ind=document.getElementById('oref-ind');
  ind.className='oref-ind'+(state==='ok'?'':(state==='alert'?' alert':' offline'));
  document.getElementById('oref-ts').textContent=new Date().toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
}

// â”€â”€ ALERTS
async function checkAlerts(){
  try{
    const r=await fetch('/api/alerts?t='+Date.now());
    const txt=await r.text();
    oFails=0;
    if(!txt||txt.trim()===''||txt.trim()==='{}'){setOrefUI('ok');clearAlert();return}
    const d=JSON.parse(txt);
    if(d&&d.data&&d.data.length>0){
      setOrefUI('alert');
      triggerAlert(d.data,d.title||'×™×¨×™ ×¨×§×˜×•×ª',d.data.join(','));
    }else{setOrefUI('ok');clearAlert()}
  }catch(e){
    oFails++;
    if(oFails>=3)setOrefUI('offline');
  }
}

function triggerAlert(areas,type,key){
  const str=Array.isArray(areas)?areas.join(' â€¢ '):areas;
  alert=true;
  document.getElementById('abox').classList.add('danger');
  document.getElementById('abox-icon').textContent='ğŸš¨';
  document.getElementById('abox-status').textContent='××–×¢×§×” ×¤×¢×™×œ×”!';
  document.getElementById('abox-areas').textContent=str;
  document.getElementById('abadge').classList.add('danger');
  document.getElementById('strip-areas').textContent=str;
  document.getElementById('alert-strip').classList.add('on');
  if(key!==lastKey){
    lastKey=key;
    document.getElementById('o-areas').textContent=str;
    document.getElementById('o-type').textContent=type;
    document.getElementById('overlay').classList.add('on');
    playAlarm();
    if(gst('vib')&&navigator.vibrate)navigator.vibrate([500,150,500,150,500,150,500]);
    if('Notification'in window&&Notification.permission==='granted')
      new Notification('ğŸš¨ ××–×¢×§×” â€” '+type,{body:str,icon:'/icon-192.png',requireInteraction:true});
  }
}

function clearAlert(){
  if(!alert)return;alert=false;lastKey='';
  document.getElementById('abox').classList.remove('danger');
  document.getElementById('abox-icon').textContent='âœ…';
  document.getElementById('abox-status').textContent='××™×Ÿ ××–×¢×§×•×ª ×›×¨×’×¢';
  document.getElementById('abox-areas').textContent='';
  document.getElementById('abadge').classList.remove('danger');
  document.getElementById('alert-strip').classList.remove('on');
}
function closeOverlay(){document.getElementById('overlay').classList.remove('on')}

// â”€â”€ HISTORY
async function loadHist(){
  try{
    const r=await fetch('/api/alerts/history');
    const d=await r.json();
    const el=document.getElementById('hist-list');
    if(!Array.isArray(d)||!d.length){
      el.innerHTML='<div style="color:var(--text3);font-size:11px;padding:8px 0;font-family:JetBrains Mono,monospace">××™×Ÿ ××–×¢×§×•×ª ×”×™×•×</div>';
      return;
    }
    el.innerHTML=d.slice(0,12).map(a=>`
      <div class="hcard">
        <div>
          <div class="hcard-city">${a.cities||(Array.isArray(a.data)?a.data.join(', '):'')||'â€”'}</div>
          <div class="hcard-type">${a.alertHeader||a.title||''}</div>
        </div>
        <div class="hcard-time">${a.alertDate?new Date(a.alertDate).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'}):''}</div>
      </div>
    `).join('');
  }catch(e){}
}

// â”€â”€ INIT
if('serviceWorker'in navigator)navigator.serviceWorker.register('/sw.js');
loadNews(true);
checkAlerts();setInterval(checkAlerts,5000);
loadHist();setInterval(loadHist,30000);
</script>
</body>
  </html>
