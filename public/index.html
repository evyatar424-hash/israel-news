<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0f0f0f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="×—×“×©×•×ª LIVE">
<link rel="manifest" href="/manifest.json">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<title>×—×“×©×•×ª ×™×©×¨××œ LIVE ğŸ‡®ğŸ‡±</title>
<style>
:root{--red:#ef4444;--bg:#0a0a0f;--bg2:#111118;--bg3:#1a1a24;--border:rgba(255,255,255,0.08);--text:#f1f5f9;--text2:#94a3b8;--text3:#475569}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{font-family:'Heebo','Arial Hebrew',Arial,sans-serif;background:var(--bg);color:var(--text);max-width:480px;margin:0 auto;padding-bottom:72px;min-height:100vh;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:0;height:0}
#header{background:linear-gradient(180deg,#1a0808 0%,#0f0f18 100%);border-bottom:1px solid rgba(239,68,68,0.3);position:sticky;top:0;z-index:50;box-shadow:0 4px 24px rgba(0,0,0,0.6)}
.h-top{display:flex;justify-content:space-between;align-items:center;padding:12px 16px 8px}
.logo{display:flex;align-items:center;gap:8px}
.logo-text{font-size:20px;font-weight:900;color:#fff;letter-spacing:-0.5px}
.badge-live{background:var(--red);border-radius:5px;padding:2px 7px;font-size:10px;font-weight:900;color:#fff;letter-spacing:1px;animation:blink 1s infinite}
.badge-war{background:linear-gradient(90deg,#7f1d1d,#b91c1c);border:1px solid rgba(239,68,68,0.5);border-radius:5px;padding:2px 7px;font-size:10px;font-weight:900;color:#ffd700}
#clock-time{font-size:19px;font-weight:900;color:#fbbf24;font-variant-numeric:tabular-nums;letter-spacing:1px}
#clock-date{font-size:10px;color:var(--text3);text-align:left}
.ticker{display:flex;align-items:center;gap:8px;padding:6px 16px;background:rgba(0,0,0,0.4);border-top:1px solid rgba(239,68,68,0.15)}
.ticker-label{background:var(--red);font-size:9px;font-weight:900;padding:2px 6px;border-radius:3px;color:#fff;white-space:nowrap;animation:blink 1s infinite;flex-shrink:0}
#ticker-text{font-size:12px;color:#fcd34d;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;transition:opacity 0.3s}
.tabs{display:flex}
.tab-btn{flex:1;padding:9px 0;border:none;cursor:pointer;background:transparent;font-size:12px;font-weight:600;color:var(--text3);border-bottom:2px solid transparent;transition:all 0.2s;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:4px}
.tab-btn.active{color:#f87171;border-bottom-color:var(--red);font-weight:800}
.panel{display:none}.panel.active{display:block}
#status-bar{display:flex;align-items:center;justify-content:space-between;padding:7px 16px;background:rgba(239,68,68,0.06);border-bottom:1px solid rgba(239,68,68,0.12)}
#status-text{font-size:11px;color:#f87171;font-weight:600;flex:1}
#refresh-btn{padding:4px 12px;border-radius:20px;background:var(--red);border:none;color:#fff;font-size:11px;cursor:pointer;font-weight:800;font-family:inherit}
.src-scroll{display:flex;gap:6px;padding:10px 16px;overflow-x:auto;scrollbar-width:none;border-bottom:1px solid var(--border)}
.src-btn{padding:5px 12px;border-radius:20px;border:1px solid var(--border);cursor:pointer;background:var(--bg3);color:var(--text2);font-size:11px;white-space:nowrap;flex-shrink:0;font-family:inherit;font-weight:600}
#news-list{padding:10px 12px}
.news-card{display:block;text-decoration:none;color:inherit;background:var(--bg2);border:1px solid var(--border);border-radius:14px;padding:13px 14px 13px 17px;margin-bottom:8px;position:relative;overflow:hidden;transition:transform 0.15s}
.news-card:active{transform:scale(0.99)}
.news-stripe{position:absolute;top:0;right:0;bottom:0;width:3px;border-radius:0 14px 14px 0}
.card-row1{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;gap:6px}
.src-chip{font-size:10px;font-weight:800;padding:2px 8px;border-radius:6px;white-space:nowrap}
.time-chip{font-size:10px;color:var(--text3);white-space:nowrap}
.card-title{font-size:14px;font-weight:700;line-height:1.5;color:#e2e8f0}
.card-desc{font-size:12px;color:var(--text3);line-height:1.4;margin-top:5px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.new-dot{display:inline-block;width:7px;height:7px;border-radius:50%;background:#22c55e;box-shadow:0 0 6px #22c55e;margin-left:5px;vertical-align:middle}
.alerts-wrap{padding:14px}
#alert-box{border-radius:18px;padding:22px 20px;margin-bottom:14px;text-align:center;border:2px solid #22c55e;background:rgba(34,197,94,0.06);transition:all 0.3s}
#alert-box.danger{background:linear-gradient(135deg,rgba(127,29,29,0.7),rgba(153,27,27,0.45));border-color:var(--red);animation:pulseAlert 1s infinite}
#alert-emoji{font-size:48px;margin-bottom:4px}
#alert-status{font-size:18px;font-weight:900}
#alert-areas{font-size:14px;color:#fecaca;margin-top:8px;line-height:1.9;font-weight:600}
.alert-sub{font-size:11px;color:var(--text3);margin-top:8px}
.safety-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px}
.safety-card{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:13px;text-align:center}
.hist-title{font-size:12px;font-weight:700;color:var(--text3);margin-bottom:8px}
.hist-card{background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:10px 14px;margin-bottom:7px;display:flex;justify-content:space-between;align-items:center}
.settings-wrap{padding:16px}
.settings-section{margin-bottom:20px}
.settings-title{font-size:11px;font-weight:800;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}
.settings-card{background:var(--bg2);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.settings-row{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
.settings-row:last-child{border-bottom:none}
.settings-label{font-size:14px;font-weight:600;color:var(--text)}
.settings-sub{font-size:11px;color:var(--text3);margin-top:2px}
.toggle{width:46px;height:26px;border-radius:13px;background:var(--bg3);border:2px solid var(--border);cursor:pointer;position:relative;transition:all 0.2s;flex-shrink:0}
.toggle.on{background:var(--red);border-color:var(--red)}
.toggle::after{content:'';position:absolute;top:2px;right:2px;width:18px;height:18px;border-radius:50%;background:#fff;transition:all 0.2s}
.toggle.on::after{right:22px}
.vol-slider{width:100%;accent-color:var(--red);cursor:pointer;margin-top:8px}
.test-btn{width:100%;padding:12px;border-radius:10px;background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);color:#f87171;font-size:13px;font-weight:700;cursor:pointer;font-family:inherit;margin-top:6px}
.notif-btn{width:100%;padding:13px;border-radius:12px;background:var(--red);border:none;color:#fff;font-size:14px;font-weight:800;cursor:pointer;font-family:inherit;margin-bottom:10px}
#alert-overlay{display:none;position:fixed;inset:0;z-index:999;background:rgba(0,0,0,0.92);align-items:center;justify-content:center}
#alert-overlay.show{display:flex}
.alert-modal{background:linear-gradient(135deg,#7f1d1d,#991b1b);border:3px solid var(--red);border-radius:22px;padding:32px 28px;text-align:center;width:88%;max-width:340px;box-shadow:0 0 80px rgba(239,68,68,0.7);animation:pulseAlert 1s infinite}
.alert-close{margin-top:18px;padding:10px 28px;border-radius:30px;border:2px solid var(--red);background:transparent;color:#fca5a5;font-size:14px;cursor:pointer;font-weight:800;font-family:inherit}
#install-banner{display:none;background:linear-gradient(90deg,rgba(59,130,246,0.15),rgba(37,99,235,0.1));border-bottom:1px solid rgba(59,130,246,0.25);padding:10px 16px;align-items:center;gap:10px}
#install-banner.show{display:flex}
.install-btn{padding:7px 14px;border-radius:14px;background:#3b82f6;border:none;color:#fff;font-size:12px;font-weight:800;cursor:pointer;font-family:inherit}
#bottom-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;z-index:100;background:rgba(10,10,15,0.97);border-top:1px solid var(--border);display:flex;backdrop-filter:blur(20px);padding-bottom:env(safe-area-inset-bottom)}
.nav-btn{flex:1;padding:10px 0;border:none;cursor:pointer;background:transparent;font-size:10px;font-weight:600;color:var(--text3);display:flex;flex-direction:column;align-items:center;gap:3px;font-family:inherit;position:relative}
.nav-btn.active{color:#f87171;font-weight:800}
.nav-icon{font-size:20px;line-height:1}
.nav-dot{position:absolute;top:8px;right:calc(50% - 14px);width:7px;height:7px;border-radius:50%;background:#22c55e;box-shadow:0 0 5px #22c55e}
.nav-dot.red{background:var(--red);box-shadow:0 0 6px var(--red);animation:blink 0.8s infinite}
.empty{text-align:center;padding:48px 20px;color:var(--text3)}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.25}}
@keyframes pulseAlert{0%,100%{box-shadow:0 0 30px rgba(239,68,68,0.5)}50%{box-shadow:0 0 70px rgba(239,68,68,0.9)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
@keyframes spin{to{transform:rotate(360deg)}}
.spin{display:inline-block;animation:spin 0.7s linear infinite}
</style>
</head>
<body>
<div id="alert-overlay">
  <div class="alert-modal">
    <div style="font-size:64px">ğŸš¨</div>
    <div style="font-size:28px;font-weight:900;color:#fca5a5;margin-top:4px">××–×¢×§×”!</div>
    <div id="overlay-type" style="font-size:17px;font-weight:700;color:#fff;margin-top:6px"></div>
    <div id="overlay-areas" style="font-size:15px;color:#fecaca;margin-top:10px;line-height:1.9;font-weight:600"></div>
    <div style="margin-top:14px;font-size:13px;color:#f87171;font-weight:800">âš ï¸ ×”×™×›× ×¡×• ×œ××¨×—×‘ ××•×’×Ÿ ××™×™×“×™×ª!</div>
    <button class="alert-close" onclick="dismissAlert()">×”×‘× ×ª×™</button>
  </div>
</div>
<div id="install-banner">
  <div style="flex:1"><div style="font-size:13px;font-weight:700;color:#93c5fd">ğŸ“² ×”×ª×§×Ÿ ×›××¤×œ×™×§×¦×™×”</div><div style="font-size:11px;color:#64748b;margin-top:1px">×§×‘×œ ×¤×•×©×™× ×•××–×¢×§×•×ª</div></div>
  <button class="install-btn" id="install-btn">×”×ª×§×Ÿ</button>
  <button style="background:transparent;border:none;color:#475569;font-size:18px;cursor:pointer;padding:0 4px" onclick="document.getElementById('install-banner').classList.remove('show')">âœ•</button>
</div>
<div id="header">
  <div class="h-top">
    <div class="logo">
      <span style="font-size:22px">ğŸ‡®ğŸ‡±</span>
      <span class="logo-text">×—×“×©×•×ª LIVE</span>
      <span class="badge-live">LIVE</span>
      <span class="badge-war">âš”ï¸ ××œ×—××”</span>
    </div>
    <div style="text-align:left">
      <div id="clock-time">00:00</div>
      <div id="clock-date"></div>
    </div>
  </div>
  <div class="ticker"><span class="ticker-label">â— ×©×™×“×•×¨</span><span id="ticker-text">××ª×—×‘×¨...</span></div>
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('news',this)">ğŸ“° ×—×“×©×•×ª</button>
    <button class="tab-btn" onclick="switchTab('alerts',this)">ğŸš¨ ××–×¢×§×•×ª</button>
    <button class="tab-btn" onclick="switchTab('settings',this)">âš™ï¸ ×”×’×“×¨×•×ª</button>
  </div>
</div>
<div id="panel-news" class="panel active">
  <div id="status-bar">
    <span id="status-text"><span class="spin">âŸ³</span> ××ª×—×‘×¨...</span>
    <button id="refresh-btn" onclick="loadNews(true)">âŸ³ ×¨×¢× ×Ÿ</button>
  </div>
  <div class="src-scroll" id="src-tabs"></div>
  <div id="news-list"><div class="empty"><div style="font-size:44px">ğŸ“¡</div><p>×˜×•×¢×Ÿ ×—×“×©×•×ª...</p></div></div>
</div>
<div id="panel-alerts" class="panel">
  <div class="alerts-wrap">
    <div id="alert-box">
      <div id="alert-emoji">âœ…</div>
      <div id="alert-status" style="color:#4ade80">××™×Ÿ ××–×¢×§×•×ª ×›×¨×’×¢</div>
      <div id="alert-areas"></div>
      <div class="alert-sub">××ª×¢×“×›×Ÿ ×›×œ 5 ×©× ×™×•×ª â€¢ ×¤×™×§×•×“ ×”×¢×•×¨×£</div>
    </div>
    <div class="safety-grid">
      <div class="safety-card"><div style="font-size:26px">ğŸƒ</div><div style="font-size:12px;color:#94a3b8;margin-top:3px">×‘× ×™×™×Ÿ ×¨×’×™×œ</div><div style="font-size:15px;font-weight:900;color:#fbbf24;margin-top:3px">90 ×©× '</div></div>
      <div class="safety-card"><div style="font-size:26px">ğŸ </div><div style="font-size:12px;color:#94a3b8;margin-top:3px">×‘×™×ª ×¤×¨×˜×™</div><div style="font-size:15px;font-weight:900;color:#fb923c;margin-top:3px">60 ×©× '</div></div>
      <div class="safety-card"><div style="font-size:26px">ğŸŒ³</div><div style="font-size:12px;color:#94a3b8;margin-top:3px">×©×˜×— ×¤×ª×•×—</div><div style="font-size:15px;font-weight:900;color:#f87171;margin-top:3px">30 ×©× '</div></div>
      <div class="safety-card"><div style="font-size:26px">ğŸš—</div><div style="font-size:12px;color:#94a3b8;margin-top:3px">×¨×›×‘</div><div style="font-size:15px;font-weight:900;color:#c084fc;margin-top:3px">×¢×¦×•×¨ ×•×©×›×‘</div></div>
    </div>
    <div class="hist-title">ğŸ“‹ ××–×¢×§×•×ª ×”×™×•×</div>
    <div id="alert-history"><div style="color:#475569;text-align:center;padding:14px;font-size:13px">×˜×•×¢×Ÿ...</div></div>
  </div>
</div>
<div id="panel-settings" class="panel">
  <div class="settings-wrap">
    <div class="settings-section">
      <div class="settings-title">ğŸ”” ×”×ª×¨××•×ª</div>
      <button class="notif-btn" onclick="requestNotifPermission()">×”×¤×¢×œ ×”×ª×¨××•×ª Push ğŸ””</button>
      <div class="settings-card">
        <div class="settings-row"><div><div class="settings-label">××–×¢×§×•×ª ×¤×™×§×•×“ ×”×¢×•×¨×£</div><div class="settings-sub">×”×ª×¨××” ××™×™×“×™×ª + ×•×™×‘×¨×¦×™×”</div></div><div class="toggle on" id="toggle-alerts" onclick="toggleSetting('alerts')"></div></div>
        <div class="settings-row"><div><div class="settings-label">××‘×–×§×™ ×—×“×©×•×ª</div><div class="settings-sub">×¢×“×›×•× ×™× ×—×©×•×‘×™× ×‘×œ×‘×“</div></div><div class="toggle" id="toggle-news" onclick="toggleSetting('news')"></div></div>
        <div class="settings-row"><div><div class="settings-label">×¢×“×›×•× ×™× ×‘×œ×™×œ×”</div><div class="settings-sub">×”×ª×¨××•×ª ×’× ×‘×™×Ÿ 23:00-7:00</div></div><div class="toggle" id="toggle-night" onclick="toggleSetting('night')"></div></div>
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-title">ğŸ”Š ×¦×œ×™×œ×™×</div>
      <div class="settings-card">
        <div class="settings-row"><div><div class="settings-label">×¦×œ×™×œ ××–×¢×§×”</div><div class="settings-sub">×¦×¤×™×¨×” ×‘×¢×ª ××–×¢×§×”</div></div><div class="toggle on" id="toggle-sound" onclick="toggleSetting('sound')"></div></div>
        <div class="settings-row"><div><div class="settings-label">×•×™×‘×¨×¦×™×”</div><div class="settings-sub">×¨×˜×˜ ×‘××–×¢×§×”</div></div><div class="toggle on" id="toggle-vibrate" onclick="toggleSetting('vibrate')"></div></div>
        <div class="settings-row" style="flex-direction:column;align-items:flex-start;gap:8px"><div class="settings-label">×¢×•×¦××ª ×§×•×œ</div><input type="range" min="0" max="100" value="80" class="vol-slider" id="vol-slider"></div>
      </div>
      <button class="test-btn" onclick="testAlert()">ğŸ”Š ×‘×“×•×§ ×¦×œ×™×œ ××–×¢×§×”</button>
    </div>
    <div class="settings-section">
      <div class="settings-title">âš¡ ×¢×“×›×•× ×™×</div>
      <div class="settings-card">
        <div class="settings-row"><div><div class="settings-label">×¨×¢× ×•×Ÿ ××•×˜×•××˜×™</div><div class="settings-sub">×›×œ 5 ×©× ×™×•×ª</div></div><div class="toggle on" id="toggle-autorefresh" onclick="toggleSetting('autorefresh')"></div></div>
      </div>
    </div>
    <div style="text-align:center;padding:16px;font-size:11px;color:#334155">×—×“×©×•×ª ×™×©×¨××œ LIVE v2.0<br>ynet â€¢ ×•×•××œ×” â€¢ ×›××Ÿ â€¢ ×¢×¨×•×¥ 12 â€¢ ×¢×¨×•×¥ 13 â€¢ ×¢×¨×•×¥ 14 â€¢ ×’×œ×¦ â€¢ ××¢×¨×™×‘ â€¢ ×”××¨×¥ â€¢ ×“×•×‘×¨ ×¦×”×´×œ</div>
  </div>
</div>
<div id="bottom-nav">
  <button class="nav-btn active" onclick="switchTab('news',null)" id="nav-news"><span class="nav-icon">ğŸ“°</span>×—×“×©×•×ª</button>
  <button class="nav-btn" onclick="switchTab('alerts',null)" id="nav-alerts"><div class="nav-dot" id="alert-dot"></div><span class="nav-icon">ğŸš¨</span>××–×¢×§×•×ª</button>
  <button class="nav-btn" onclick="switchTab('settings',null)" id="nav-settings"><span class="nav-icon">âš™ï¸</span>×”×’×“×¨×•×ª</button>
</div>
<script>
const settings=JSON.parse(localStorage.getItem('news_settings')||'{}');
const defaults={alerts:true,news:false,night:false,sound:true,vibrate:true,autorefresh:true};
function getSetting(k){return k in settings?settings[k]:defaults[k]}
function saveSetting(k,v){settings[k]=v;localStorage.setItem('news_settings',JSON.stringify(settings))}
function initToggles(){['alerts','news','night','sound','vibrate','autorefresh'].forEach(k=>{const el=document.getElementById('toggle-'+k);if(el){if(getSetting(k))el.classList.add('on');else el.classList.remove('on')}})}
function toggleSetting(k){const v=!getSetting(k);saveSetting(k,v);const el=document.getElementById('toggle-'+k);if(el){v?el.classList.add('on'):el.classList.remove('on')}if(k==='autorefresh'){v?startAutoRefresh():stopAutoRefresh()}}
initToggles();
let allItems=[],currentSrc='all',hasAlert=false,tickIdx=0,autoRefreshTimer=null,volume=0.8,lastAlertKey='',deferredPrompt=null,isLoading=false;
window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;document.getElementById('install-banner').classList.add('show')});
document.getElementById('install-btn').addEventListener('click',async()=>{if(!deferredPrompt)return;deferredPrompt.prompt();deferredPrompt=null;document.getElementById('install-banner').classList.remove('show')});
if('serviceWorker'in navigator)navigator.serviceWorker.register('/sw.js');
async function requestNotifPermission(){if(!('Notification'in window)){alert('×”×“×¤×“×¤×Ÿ ×©×œ×š ×œ× ×ª×•××š ×‘×”×ª×¨××•×ª');return}const p=await Notification.requestPermission();if(p==='granted')alert('âœ… ×”×ª×¨××•×ª ×”×•×¤×¢×œ×•!');else alert('âš ï¸ ×× × ××©×¨ ×”×ª×¨××•×ª ×‘×”×’×“×¨×•×ª ×”×“×¤×“×¤×Ÿ')}
function tick(){const n=new Date();document.getElementById('clock-time').textContent=n.toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'});document.getElementById('clock-date').textContent=n.toLocaleDateString('he-IL',{day:'numeric',month:'long'})}
tick();setInterval(tick,1000);
function rotateTicker(){if(!allItems.length)return;const el=document.getElementById('ticker-text');el.style.opacity='0';setTimeout(()=>{const item=allItems[tickIdx%Math.min(allItems.length,40)];if(item)el.textContent=item.sourceIcon+' '+item.title;el.style.opacity='1';tickIdx++},300)}
setInterval(rotateTicker,5000);
function switchTab(tab,btn){document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));document.getElementById('panel-'+tab).classList.add('active');if(btn)btn.classList.add('active');const m={news:'nav-news',alerts:'nav-alerts',settings:'nav-settings'};if(m[tab])document.getElementById(m[tab]).classList.add('active')}
const CH={ynet:{name:'ynet',color:'#E8001E',icon:'ğŸ“°'},ynet_war:{name:'ynet ××œ×—××”',color:'#b30000',icon:'ğŸš¨'},walla:{name:'×•×•××œ×”',color:'#FF6B00',icon:'ğŸ”¥'},walla_war:{name:'×•×•××œ×” ×‘×™×˜×—×•×Ÿ',color:'#cc5500',icon:'âš”ï¸'},maariv:{name:'××¢×¨×™×‘',color:'#0891B2',icon:'ğŸ—ï¸'},kan:{name:'×›××Ÿ 11',color:'#2563EB',icon:'ğŸ™ï¸'},ch12:{name:'×¢×¨×•×¥ 12',color:'#C8102E',icon:'ğŸ“º'},ch13:{name:'×¢×¨×•×¥ 13',color:'#7C3AED',icon:'ğŸ“¡'},ch14:{name:'×¢×¨×•×¥ 14',color:'#d97706',icon:'ğŸ¦…'},galatz:{name:'×’×œ×¦',color:'#15803d',icon:'ğŸ–ï¸'},haaretz:{name:'×”××¨×¥',color:'#1d4ed8',icon:'ğŸ“œ'},idf:{name:'×“×•×‘×¨ ×¦×”×´×œ',color:'#166534',icon:'ğŸª–'}};
function renderSrcTabs(){const el=document.getElementById('src-tabs');const sources=['all',...new Set(allItems.map(i=>i.source))];el.innerHTML='';sources.forEach(id=>{const ch=id==='all'?{name:'ğŸŒ ×”×›×œ',color:'#fbbf24',icon:''}:(CH[id]||{name:id,color:'#6b7280',icon:'ğŸ“°'});const b=document.createElement('button');b.className='src-btn'+(id===currentSrc?' active':'');b.textContent=(ch.icon?ch.icon+' ':'')+ch.name;if(id===currentSrc){b.style.background=ch.color+'20';b.style.borderColor=ch.color+'60';b.style.color=ch.color;b.style.fontWeight='800'}b.onclick=()=>{currentSrc=id;renderSrcTabs();renderList()};el.appendChild(b)})}
const seenIds=new Set();
function renderList(){const list=document.getElementById('news-list');const filtered=currentSrc==='all'?allItems:allItems.filter(n=>n.source===currentSrc);if(!filtered.length){list.innerHTML='<div class="empty"><div style="font-size:44px">ğŸ“¡</div><p>×œ× × ××¦××• ×›×ª×‘×•×ª</p></div>';return}list.innerHTML='';filtered.forEach((item,idx)=>{const ch=CH[item.source]||{name:item.source,color:'#6b7280',icon:'ğŸ“°'};const isNew=!seenIds.has(item.id);const a=document.createElement('a');a.className='news-card';a.href=item.link||'#';a.target='_blank';a.rel='noopener';a.style.cssText=`animation:fadeUp 0.2s ease ${Math.min(idx,10)*0.03}s both`;a.innerHTML=`<div class="news-stripe" style="background:${ch.color}"></div><div class="card-row1"><span class="src-chip" style="background:${ch.color}18;border:1px solid ${ch.color}40;color:${ch.color}">${ch.icon} ${ch.name}</span><span class="time-chip">ğŸ• ${item.timeAgo}${isNew?'<span class="new-dot"></span>':''}</span></div><div class="card-title">${item.title}</div>${item.desc?`<div class="card-desc">${item.desc}</div>`:''}`;list.appendChild(a);seenIds.add(item.id)})}
async function loadNews(manual=false){if(isLoading&&!manual)return;isLoading=true;const btn=document.getElementById('refresh-btn');const status=document.getElementById('status-text');if(manual){btn.disabled=true;btn.innerHTML='<span class="spin">âŸ³</span>'}try{const res=await fetch('/api/news?t='+Date.now());const data=await res.json();if(data.items&&data.items.length>0){allItems=data.items;const t=new Date(data.updated).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'});status.textContent='âœ“ '+t+' â€¢ '+data.total+' ×›×ª×‘×•×ª';renderSrcTabs();renderList();rotateTicker()}}catch(e){if(manual)status.textContent='âš ï¸ ×©×’×™××ª ×—×™×‘×•×¨'}if(manual){btn.disabled=false;btn.innerHTML='âŸ³ ×¨×¢× ×Ÿ'}isLoading=false}
function startAutoRefresh(){stopAutoRefresh();if(getSetting('autorefresh'))autoRefreshTimer=setInterval(()=>loadNews(false),5000)}
function stopAutoRefresh(){if(autoRefreshTimer){clearInterval(autoRefreshTimer);autoRefreshTimer=null}}
startAutoRefresh();
document.getElementById('vol-slider').oninput=e=>{volume=e.target.value/100};
function playAlertSound(){if(!getSetting('sound'))return;try{const ctx=new(window.AudioContext||window.webkitAudioContext)();const pattern=[[440,0.15],[880,0.15],[440,0.15],[880,0.15],[440,0.15]];let t=ctx.currentTime;pattern.forEach(([freq,dur])=>{const o=ctx.createOscillator();const g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sawtooth';o.frequency.value=freq;g.gain.setValueAtTime(volume*0.4,t);g.gain.exponentialRampToValueAtTime(0.001,t+dur);o.start(t);o.stop(t+dur);t+=dur+0.05})}catch(e){}}
function testAlert(){playAlertSound();if(getSetting('vibrate')&&navigator.vibrate)navigator.vibrate([200,100,200,100,200])}
async function checkAlerts(){try{const res=await fetch('/api/alerts?t='+Date.now());const text=await res.text();if(!text||text.trim()===''||text.trim()==='{}'){clearAlert();return}const data=JSON.parse(text);if(data&&data.data&&data.data.length>0){const key=data.data.join(',');triggerAlert(data.data,data.title||'×™×¨×™ ×¨×§×˜×•×ª',key)}else clearAlert()}catch(e){}}
function triggerAlert(areas,type,key){const str=Array.isArray(areas)?areas.join(' â€¢ '):areas;hasAlert=true;document.getElementById('alert-box').classList.add('danger');document.getElementById('alert-emoji').textContent='ğŸš¨';document.getElementById('alert-status').textContent='××–×¢×§×” ×¤×¢×™×œ×”!';document.getElementById('alert-status').style.color='#fca5a5';document.getElementById('alert-areas').textContent=str;document.getElementById('alert-dot').classList.add('red');if(key!==lastAlertKey){lastAlertKey=key;document.getElementById('overlay-areas').textContent=str;document.getElementById('overlay-type').textContent=type;document.getElementById('alert-overlay').classList.add('show');playAlertSound();if(getSetting('vibrate')&&navigator.vibrate)navigator.vibrate([400,100,400,100,400,100,400]);if('Notification'in window&&Notification.permission==='granted')new Notification('ğŸš¨ ××–×¢×§×”! '+type,{body:str,icon:'/icon-192.png'})}}
function clearAlert(){if(!hasAlert)return;hasAlert=false;lastAlertKey='';document.getElementById('alert-box').classList.remove('danger');document.getElementById('alert-emoji').textContent='âœ…';document.getElementById('alert-status').textContent='××™×Ÿ ××–×¢×§×•×ª ×›×¨×’×¢';document.getElementById('alert-status').style.color='#4ade80';document.getElementById('alert-areas').textContent='';document.getElementById('alert-dot').classList.remove('red')}
function dismissAlert(){document.getElementById('alert-overlay').classList.remove('show')}
async function loadAlertHistory(){try{const res=await fetch('/api/alerts/history');const data=await res.json();if(!Array.isArray(data)||!data.length)return;document.getElementById('alert-history').innerHTML=data.slice(0,8).map(a=>`<div class="hist-card"><div><div style="font-size:13px;font-weight:700;color:#e2e8f0">${a.cities||(Array.isArray(a.data)?a.data.join(', '):'')||''}</div><div style="font-size:11px;color:#64748b">${a.alertHeader||a.title||''}</div></div><div style="text-align:left"><div style="font-size:12px;font-weight:700;color:#fbbf24">${a.alertDate?new Date(a.alertDate).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'}):''}</div><div style="font-size:10px;color:#4ade80">âœ“ ×”×¡×ª×™×™××”</div></div></div>`).join('')}catch(e){}}
loadNews(true);
checkAlerts();setInterval(checkAlerts,5000);
loadAlertHistory();setInterval(loadAlertHistory,30000);
</script>
</body>
</html>
