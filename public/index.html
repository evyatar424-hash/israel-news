<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#1c1e26">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="IL NEWS">
<link rel="manifest" href="/manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<title>IL NEWS</title>
<style>
:root{
  --bg:#1c1e26;
  --bg2:#22242e;
  --bg3:#282b36;
  --card:#2a2d3a;
  --card2:#303447;
  --border:rgba(255,255,255,0.07);
  --border2:rgba(255,255,255,0.12);
  --text:#dde1f0;
  --text2:#8b90b0;
  --text3:#4a4f6a;
  --red:#f03e3e;
  --red-soft:rgba(240,62,62,0.12);
  --amber:#f59e0b;
  --green:#34d399;
  --blue:#60a5fa;
  --r:13px;
  --f:'Heebo',sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{background:var(--bg)}
body{
  font-family:var(--f);
  color:var(--text);
  max-width:480px;margin:0 auto;
  padding-bottom:76px;min-height:100vh;
  -webkit-font-smoothing:antialiased;
  overflow-x:hidden;
}
::-webkit-scrollbar{display:none}

/* â”€â”€ subtle noise texture overlay â”€â”€ */
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  opacity:0.4;
}

/* â”€â”€ HEADER â”€â”€ */
#header{
  position:sticky;top:0;z-index:50;
  background:rgba(28,30,38,0.96);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);
}
.htop{display:flex;justify-content:space-between;align-items:center;padding:11px 15px 9px}
.logo{display:flex;align-items:center;gap:8px}
.logo-flag{font-size:20px}
.logo-text{font-size:18px;font-weight:900;color:var(--text);letter-spacing:-0.5px}
.logo-text b{color:var(--red)}
.live-badge{
  display:flex;align-items:center;gap:4px;
  background:var(--red-soft);border:1px solid rgba(240,62,62,0.3);
  border-radius:6px;padding:3px 8px;
  font-size:10px;font-weight:800;color:var(--red);letter-spacing:1px;
}
.live-dot{width:5px;height:5px;border-radius:50%;background:var(--red);animation:ldot 1.2s ease-in-out infinite}
@keyframes ldot{0%,100%{opacity:1}50%{opacity:0.2}}
.clock-area{text-align:left}
#clk{font-size:15px;font-weight:700;color:var(--text);font-variant-numeric:tabular-nums;letter-spacing:0.5px}
#clkd{font-size:10px;color:var(--text3);margin-top:1px}

/* ALERT STRIP */
#astrip{display:none;padding:9px 15px;background:linear-gradient(90deg,rgba(240,62,62,0.15),rgba(200,20,20,0.1));border-bottom:1px solid rgba(240,62,62,0.2);animation:stripblink 1.5s ease-in-out infinite}
#astrip.show{display:flex;align-items:center;gap:10px}
.astrip-icon{font-size:20px;animation:wiggle 0.5s ease-in-out infinite alternate}
@keyframes wiggle{from{transform:rotate(-8deg)}to{transform:rotate(8deg)}}
@keyframes stripblink{0%,100%{background:linear-gradient(90deg,rgba(240,62,62,0.15),rgba(200,20,20,0.1))}50%{background:linear-gradient(90deg,rgba(240,62,62,0.25),rgba(200,20,20,0.18))}}
.astrip-t{font-size:12px;font-weight:800;color:#ff7b7b}
.astrip-a{font-size:11px;color:rgba(255,123,123,0.7);margin-top:1px}

/* TICKER */
.ticker{display:flex;align-items:center;gap:8px;padding:5px 15px;background:var(--bg2);border-bottom:1px solid var(--border);overflow:hidden}
.ticker-lbl{font-size:9px;font-weight:800;color:var(--amber);background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.2);border-radius:4px;padding:2px 6px;white-space:nowrap;flex-shrink:0;letter-spacing:1px}
#ticker-txt{font-size:12px;color:var(--text2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;transition:opacity 0.35s}

/* TABS */
.tabs{display:flex;background:var(--bg);border-bottom:1px solid var(--border)}
.tab{flex:1;padding:9px 0;border:none;cursor:pointer;background:transparent;font-size:11px;font-weight:600;color:var(--text3);border-bottom:2px solid transparent;transition:all 0.18s;font-family:var(--f);display:flex;align-items:center;justify-content:center;gap:4px}
.tab.on{color:var(--red);border-bottom-color:var(--red);font-weight:800}
.panel{display:none}.panel.on{display:block}

/* STATUS */
.sbar{display:flex;align-items:center;justify-content:space-between;padding:7px 13px;background:var(--bg2);border-bottom:1px solid var(--border)}
#stxt{font-size:10px;color:var(--text3)}
#rfbtn{padding:4px 11px;border-radius:6px;background:var(--red-soft);border:1px solid rgba(240,62,62,0.25);color:var(--red);font-size:10px;cursor:pointer;font-weight:700;font-family:var(--f);letter-spacing:0.3px}

/* SOURCE CHIPS */
.schips{display:flex;gap:5px;padding:8px 13px;overflow-x:auto;scrollbar-width:none;border-bottom:1px solid var(--border);background:var(--bg2)}
.schip{padding:4px 11px;border-radius:20px;border:1px solid var(--border2);cursor:pointer;background:transparent;color:var(--text3);font-size:10px;white-space:nowrap;flex-shrink:0;font-family:var(--f);font-weight:600;transition:all 0.14s}

/* QUICK LINKS */
.qlinks{display:flex;gap:6px;padding:8px 13px;overflow-x:auto;scrollbar-width:none;border-bottom:1px solid var(--border);background:var(--bg)}
.qlink{display:flex;align-items:center;gap:5px;padding:5px 12px;border-radius:8px;background:var(--card);border:1px solid var(--border2);color:var(--text2);font-size:10px;font-weight:700;white-space:nowrap;flex-shrink:0;text-decoration:none;transition:all 0.14s}
.qlink:active{background:var(--card2)}

/* NEWS LIST */
#nlist{padding:10px 11px;position:relative;z-index:1}
.sep{display:flex;align-items:center;gap:7px;padding:3px 3px 9px;font-size:9px;color:var(--text3);letter-spacing:1px;text-transform:uppercase}
.sep-l{flex:1;height:1px;background:var(--border)}

.ncard{display:block;text-decoration:none;color:inherit;background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:12px 13px 11px 12px;margin-bottom:7px;position:relative;overflow:hidden;transition:background 0.12s,transform 0.1s}
.ncard:active{transform:scale(0.988);background:var(--card2)}
.ncard::after{content:'';position:absolute;top:0;right:0;bottom:0;width:3px;background:var(--src-c,var(--border2));border-radius:0 var(--r) var(--r) 0}
.ncard.top{background:linear-gradient(135deg,rgba(240,62,62,0.08) 0%,var(--card) 55%);border-color:rgba(240,62,62,0.18)}
.ncard.fresh::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(52,211,153,0.04),transparent 50%);pointer-events:none;border-radius:var(--r)}

.cmeta{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px;gap:6px}
.csrc{display:inline-flex;align-items:center;gap:4px;font-size:10px;font-weight:800;padding:2px 7px;border-radius:5px;white-space:nowrap}
.ctimerow{display:flex;align-items:center;gap:4px;flex-shrink:0}
.ctime{font-size:10px;color:var(--text3)}
.cnew{background:var(--green);color:#0a2e20;font-size:8px;font-weight:900;padding:1px 5px;border-radius:3px;letter-spacing:0.3px}
.ctitle{font-size:13.5px;font-weight:700;line-height:1.55;color:var(--text)}
.ncard.top .ctitle{color:#ff9090}
.cdesc{font-size:11.5px;color:var(--text2);line-height:1.5;margin-top:5px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.empty{text-align:center;padding:50px 20px;color:var(--text3)}

/* ALERTS */
.awrap{padding:12px;position:relative;z-index:1}
.orefbar{display:flex;align-items:center;gap:10px;padding:10px 13px;background:var(--card);border:1px solid var(--border);border-radius:var(--r);margin-bottom:10px}
.oind{width:10px;height:10px;border-radius:50%;flex-shrink:0;transition:all 0.3s}
.oind.ok{background:var(--green);box-shadow:0 0 0 0 rgba(52,211,153,0.4);animation:glow 2s infinite}
.oind.err{background:var(--text3);box-shadow:none}
.oind.alrt{background:var(--red);animation:rglow 1s infinite}
@keyframes glow{0%{box-shadow:0 0 0 0 rgba(52,211,153,0.5)}70%{box-shadow:0 0 0 7px rgba(52,211,153,0)}100%{box-shadow:0 0 0 0 rgba(52,211,153,0)}}
@keyframes rglow{0%{box-shadow:0 0 0 0 rgba(240,62,62,0.7)}70%{box-shadow:0 0 0 10px rgba(240,62,62,0)}100%{box-shadow:0 0 0 0 rgba(240,62,62,0)}}
.oname{font-size:12px;font-weight:700;color:var(--text);flex:1}
.osub{font-size:10px;color:var(--text3);margin-top:1px}
#ots{font-size:9px;color:var(--text3)}

#abox{border-radius:var(--r);padding:22px 18px;margin-bottom:10px;text-align:center;border:1.5px solid rgba(52,211,153,0.2);background:rgba(52,211,153,0.04);transition:all 0.35s}
#abox.danger{background:rgba(240,62,62,0.07);border-color:rgba(240,62,62,0.3);animation:dpulse 1.5s ease-in-out infinite}
@keyframes dpulse{0%,100%{box-shadow:0 0 0 0 rgba(240,62,62,0.15)}50%{box-shadow:0 0 0 14px rgba(240,62,62,0)}}
#aicon{font-size:44px;margin-bottom:6px}
#astatus{font-size:17px;font-weight:900;color:var(--green)}
#abox.danger #astatus{color:#ff8080}
#aareas{font-size:13px;color:#ff8080;margin-top:8px;line-height:2;font-weight:700}
.ameta{font-size:9px;color:var(--text3);margin-top:8px;display:flex;align-items:center;justify-content:center;gap:6px}
.ochip{background:rgba(52,211,153,0.08);border:1px solid rgba(52,211,153,0.2);border-radius:3px;padding:1px 5px;font-size:8px;font-weight:800;color:var(--green)}

.sgrid{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:11px}
.scard{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:13px 11px;text-align:center}
.scard-t{font-size:16px;font-weight:900;margin-top:5px;font-variant-numeric:tabular-nums}

.hhdr{font-size:9px;font-weight:800;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:7px}
.hcard{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:10px 13px;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}
.hcity{font-size:12px;font-weight:700;color:var(--text)}
.htype{font-size:10px;color:var(--text3);margin-top:2px}
.htime{font-size:11px;font-weight:700;color:var(--amber)}

/* OVERLAY */
#ovl{display:none;position:fixed;inset:0;z-index:999;background:rgba(0,0,0,0.75);backdrop-filter:blur(16px);align-items:center;justify-content:center}
#ovl.show{display:flex}
.omodal{background:var(--bg3);border:1px solid rgba(240,62,62,0.35);border-top:4px solid var(--red);border-radius:18px;padding:28px 22px;text-align:center;width:88%;max-width:340px;box-shadow:0 20px 60px rgba(0,0,0,0.5),0 0 40px rgba(240,62,62,0.1);animation:omin 0.32s cubic-bezier(0.34,1.56,0.64,1)}
@keyframes omin{from{transform:scale(0.85) translateY(16px);opacity:0}to{transform:scale(1) translateY(0);opacity:1}}
.otype{font-size:13px;color:var(--text2);margin-top:4px}
.oareas{font-size:14px;color:#ff8080;margin-top:11px;line-height:2;font-weight:700}
.owarn{margin-top:13px;padding:9px 14px;background:rgba(240,62,62,0.1);border:1px solid rgba(240,62,62,0.2);border-radius:8px;font-size:12px;font-weight:700;color:#ff8080}
.obtn{margin-top:15px;width:100%;padding:13px;border-radius:10px;border:none;background:var(--red);color:#fff;font-size:14px;font-weight:800;cursor:pointer;font-family:var(--f)}

/* SETTINGS */
.swrap{padding:12px;position:relative;z-index:1}
.ssec{margin-bottom:18px}
.sttl{font-size:9px;font-weight:800;color:var(--text3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:7px}
.sblk{background:var(--card);border:1px solid var(--border);border-radius:var(--r);overflow:hidden}
.srow{display:flex;align-items:center;justify-content:space-between;padding:13px 15px;border-bottom:1px solid var(--border)}
.srow:last-child{border-bottom:none}
.srow.col{flex-direction:column;align-items:flex-start;gap:9px}
.slbl{font-size:13px;font-weight:600;color:var(--text)}
.ssub{font-size:10px;color:var(--text3);margin-top:2px}
.tog{width:44px;height:24px;border-radius:12px;background:var(--bg3);border:none;cursor:pointer;position:relative;transition:all 0.2s;flex-shrink:0}
.tog.on{background:var(--green)}
.tog::after{content:'';position:absolute;top:3px;right:3px;width:18px;height:18px;border-radius:50%;background:#fff;box-shadow:0 1px 4px rgba(0,0,0,0.3);transition:all 0.2s}
.tog.on::after{right:23px}
.vsl{width:100%;cursor:pointer;accent-color:var(--red)}
.nbtn2{width:100%;padding:12px;border-radius:10px;background:rgba(96,165,250,0.1);border:1px solid rgba(96,165,250,0.2);color:var(--blue);font-size:13px;font-weight:700;cursor:pointer;font-family:var(--f);margin-bottom:8px}
.tbtn{width:100%;padding:11px;border-radius:10px;background:var(--red-soft);border:1px solid rgba(240,62,62,0.2);color:var(--red);font-size:12px;font-weight:700;cursor:pointer;font-family:var(--f);margin-top:6px}

/* BOTTOM NAV */
#bnav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;z-index:100;background:rgba(28,30,38,0.97);border-top:1px solid var(--border);display:flex;backdrop-filter:blur(20px);padding-bottom:env(safe-area-inset-bottom)}
.nb{flex:1;padding:10px 0;border:none;cursor:pointer;background:transparent;font-size:9px;font-weight:600;color:var(--text3);display:flex;flex-direction:column;align-items:center;gap:3px;font-family:var(--f);position:relative;transition:color 0.15s;letter-spacing:0.3px}
.nb.on{color:var(--red);font-weight:800}
.ni{font-size:20px;line-height:1}
.nbdot{position:absolute;top:7px;right:calc(50% - 15px);width:7px;height:7px;border-radius:50%;background:var(--green);border:2px solid var(--bg)}
.nbdot.alrt{background:var(--red);animation:blink 0.9s infinite}

@keyframes blink{0%,100%{opacity:1}50%{opacity:0.15}}
@keyframes fadeUp{from{opacity:0;transform:translateY(7px)}to{opacity:1;transform:translateY(0)}}
@keyframes spin{to{transform:rotate(360deg)}}
.spin{display:inline-block;animation:spin 0.6s linear infinite}
</style>
</head>
<body>

<!-- OVERLAY -->
<div id="ovl">
  <div class="omodal">
    <div style="font-size:52px">ğŸš¨</div>
    <div style="font-size:22px;font-weight:900;color:var(--red);margin-top:5px">××–×¢×§×”!</div>
    <div class="otype" id="otype"></div>
    <div class="oareas" id="oareas"></div>
    <div class="owarn">âš ï¸ ×”×™×›× ×¡×• ×œ××¨×—×‘ ××•×’×Ÿ ××™×™×“×™×ª!</div>
    <button class="obtn" onclick="closeOvl()">×”×‘× ×ª×™ â€” × ×›× ×¡×ª×™ ×œ××¨×—×‘ ××•×’×Ÿ</button>
  </div>
</div>

<!-- HEADER -->
<div id="header">
  <div class="htop">
    <div class="logo">
      <span class="logo-flag">ğŸ‡®ğŸ‡±</span>
      <span class="logo-text">IL <b>NEWS</b></span>
      <div class="live-badge"><div class="live-dot"></div>LIVE</div>
    </div>
    <div class="clock-area">
      <div id="clk">--:--</div>
      <div id="clkd"></div>
    </div>
  </div>
  <div id="astrip">
    <div class="astrip-icon">ğŸš¨</div>
    <div><div class="astrip-t">××–×¢×§×” ×¤×¢×™×œ×”!</div><div class="astrip-a" id="astrip-a"></div></div>
  </div>
  <div class="ticker"><div class="ticker-lbl">BREAKING</div><div id="ticker-txt">××ª×—×‘×¨ ×œ×¢×¨×•×¦×™×...</div></div>
  <div class="tabs">
    <button class="tab on" onclick="goTab('news',this)">ğŸ“° ×—×“×©×•×ª</button>
    <button class="tab" onclick="goTab('alerts',this)">ğŸš¨ ××–×¢×§×•×ª</button>
    <button class="tab" onclick="goTab('settings',this)">âš™ï¸ ×”×’×“×¨×•×ª</button>
  </div>
</div>

<!-- NEWS -->
<div id="panel-news" class="panel on">
  <div class="sbar">
    <span id="stxt"><span class="spin">âŸ³</span> ×˜×•×¢×Ÿ...</span>
    <button id="rfbtn" onclick="loadNews(true)">âŸ³ ×¨×¢× ×Ÿ</button>
  </div>
  <div class="schips" id="schips"></div>
  <!-- QUICK LIVE LINKS -->
  <div class="qlinks">
    <a class="qlink" href="https://www.kan.org.il/live/" target="_blank">ğŸ™ï¸ ×›××Ÿ 11 ×œ×™×™×‘</a>
    <a class="qlink" href="https://www.mako.co.il/mako-vod-live-tv/Channel-12" target="_blank">ğŸ“º ×¢×¨×•×¥ 12 ×œ×™×™×‘</a>
    <a class="qlink" href="https://13tv.co.il/live/" target="_blank">ğŸ“¡ ×¢×¨×•×¥ 13 ×œ×™×™×‘</a>
    <a class="qlink" href="https://glglz.maariv.co.il/" target="_blank">ğŸ“» ×’×œ×’×œ×¦</a>
    <a class="qlink" href="https://glz.co.il/" target="_blank">ğŸ–ï¸ ×’×œ×¦</a>
  </div>
  <div id="nlist"><div class="empty"><div style="font-size:44px">ğŸ“¡</div><p style="margin-top:10px;font-size:13px;font-weight:600">×˜×•×¢×Ÿ ×—×“×©×•×ª...</p></div></div>
</div>

<!-- ALERTS -->
<div id="panel-alerts" class="panel">
  <div class="awrap">
    <div class="orefbar">
      <div class="oind err" id="oind"></div>
      <div><div class="oname">×¤×™×§×•×“ ×”×¢×•×¨×£</div><div class="osub">oref.org.il â€¢ ×‘×“×™×§×” ×›×œ 5 ×©× ×™×•×ª</div></div>
      <div id="ots">--:--</div>
    </div>
    <div id="abox">
      <div id="aicon">âœ…</div>
      <div id="astatus">××™×Ÿ ××–×¢×§×•×ª ×›×¨×’×¢</div>
      <div id="aareas"></div>
      <div class="ameta"><span class="ochip">oref.org.il</span><span>××ª×¢×“×›×Ÿ ×›×œ 5 ×©× ×™×•×ª</span></div>
    </div>
    <div class="sgrid">
      <div class="scard"><div style="font-size:24px">ğŸƒ</div><div style="font-size:11px;color:var(--text2);margin-top:4px">×‘× ×™×™×Ÿ ×¨×’×™×œ</div><div class="scard-t" style="color:#f59e0b">90s</div></div>
      <div class="scard"><div style="font-size:24px">ğŸ </div><div style="font-size:11px;color:var(--text2);margin-top:4px">×‘×™×ª ×¤×¨×˜×™</div><div class="scard-t" style="color:#f97316">60s</div></div>
      <div class="scard"><div style="font-size:24px">ğŸŒ³</div><div style="font-size:11px;color:var(--text2);margin-top:4px">×©×˜×— ×¤×ª×•×—</div><div class="scard-t" style="color:var(--red)">30s</div></div>
      <div class="scard"><div style="font-size:24px">ğŸš—</div><div style="font-size:11px;color:var(--text2);margin-top:4px">×¨×›×‘</div><div class="scard-t" style="color:#a78bfa">×¢×¦×•×¨</div></div>
    </div>
    <div class="hhdr">××–×¢×§×•×ª ×”×™×•× â€” ×¤×™×§×•×“ ×”×¢×•×¨×£</div>
    <div id="hlist"><div style="font-size:11px;color:var(--text3);padding:8px 0">×˜×•×¢×Ÿ ×”×™×¡×˜×•×¨×™×”...</div></div>
  </div>
</div>

<!-- SETTINGS -->
<div id="panel-settings" class="panel">
  <div class="swrap">
    <div class="ssec">
      <div class="sttl">×”×ª×¨××•×ª</div>
      <button class="nbtn2" onclick="reqNotif()">ğŸ”” ×”×¤×¢×œ ×”×ª×¨××•×ª ×“×¤×“×¤×Ÿ</button>
      <div class="sblk">
        <div class="srow"><div><div class="slbl">×¦×œ×™×œ ××–×¢×§×”</div><div class="ssub">×¦×¤×™×¨×” ×‘×–××Ÿ ××–×¢×§×”</div></div><div class="tog on" id="t-sound" onclick="tog('sound')"></div></div>
        <div class="srow"><div><div class="slbl">×•×™×‘×¨×¦×™×”</div><div class="ssub">×¨×˜×˜ ×—×–×§</div></div><div class="tog on" id="t-vib" onclick="tog('vib')"></div></div>
        <div class="srow col"><div class="slbl">×¢×•×¦××ª ×§×•×œ</div><input type="range" min="0" max="100" value="80" class="vsl" id="vol" oninput="setVol(this.value)"></div>
      </div>
      <button class="tbtn" onclick="testS()">â–¶ ×‘×“×•×§ ×¦×œ×™×œ ××–×¢×§×”</button>
    </div>
    <div class="ssec">
      <div class="sttl">×¢×“×›×•× ×™×</div>
      <div class="sblk">
        <div class="srow"><div><div class="slbl">×¨×¢× ×•×Ÿ ××•×˜×•××˜×™</div><div class="ssub">×—×“×©×•×ª ×•××–×¢×§×•×ª ×›×œ 5 ×©× ×™×•×ª</div></div><div class="tog on" id="t-auto" onclick="tog('auto')"></div></div>
      </div>
    </div>
    <div style="text-align:center;padding:16px 0 4px;font-size:10px;color:var(--text3)">
      IL NEWS v2.4 â€¢ ×—×“×©×•×ª ×™×©×¨××œ ×‘×–××Ÿ ×××ª<br>
      <span style="color:var(--text3)">ynet â€¢ ×•×•××œ×” â€¢ ×›××Ÿ 11 â€¢ ×¢×¨×•×¥ 12 â€¢ ×¢×¨×•×¥ 13 â€¢ ×¢×¨×•×¥ 14 â€¢ ×××§×• â€¢ ××¢×¨×™×‘ â€¢ ×“×•×‘×¨ ×¦×‘×</span>
    </div>
  </div>
</div>

<!-- BOTTOM NAV -->
<div id="bnav">
  <button class="nb on" id="nb-news" onclick="goTab('news',null)"><span class="ni">ğŸ“°</span>×—×“×©×•×ª</button>
  <button class="nb" id="nb-alerts" onclick="goTab('alerts',null)"><div class="nbdot" id="nbdot"></div><span class="ni">ğŸš¨</span>××–×¢×§×•×ª</button>
  <button class="nb" id="nb-settings" onclick="goTab('settings',null)"><span class="ni">âš™ï¸</span>×”×’×“×¨×•×ª</button>
</div>

<script>
const ST=JSON.parse(localStorage.getItem('ilnews3')||'{}');
const DF={sound:true,vib:true,auto:true};
const gs=k=>k in ST?ST[k]:DF[k];
const ss=(k,v)=>{ST[k]=v;localStorage.setItem('ilnews3',JSON.stringify(ST))};
function tog(k){const v=!gs(k);ss(k,v);const e=document.getElementById('t-'+k);if(e)v?e.classList.add('on'):e.classList.remove('on');if(k==='auto')v?startA():stopA()}
['sound','vib','auto'].forEach(k=>{const e=document.getElementById('t-'+k);if(e)gs(k)?e.classList.add('on'):e.classList.remove('on')});

let items=[],cur='all',hasAlert=false,tIdx=0,timer=null,vol=0.8,lastKey='',oFails=0,busy=false;

// clock
function clk(){const n=new Date();document.getElementById('clk').textContent=n.toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'});document.getElementById('clkd').textContent=n.toLocaleDateString('he-IL',{weekday:'short',day:'numeric',month:'short'})}
clk();setInterval(clk,1000);

// ticker
function rotateTicker(){if(!items.length)return;const e=document.getElementById('ticker-txt');e.style.opacity='0';setTimeout(()=>{const it=items[tIdx%Math.min(items.length,60)];if(it)e.textContent=it.sourceIcon+' '+it.title;e.style.opacity='1';tIdx++},380)}
setInterval(rotateTicker,6000);

// tabs
function goTab(tab,btn){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('on'));
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('on'));
  document.querySelectorAll('.nb').forEach(b=>b.classList.remove('on'));
  document.getElementById('panel-'+tab).classList.add('on');
  if(btn)btn.classList.add('on');
  const m={news:'nb-news',alerts:'nb-alerts',settings:'nb-settings'};
  if(m[tab])document.getElementById(m[tab]).classList.add('on');
}

// channels meta
const CH={
  ynet:{n:'ynet',c:'#E8001E',i:'ğŸ“°'},
  ynet_war:{n:'ynet ××œ×—××”',c:'#ff4444',i:'ğŸ”´'},
  walla:{n:'×•×•××œ×”',c:'#FF6B00',i:'ğŸ”¥'},
  walla_war:{n:'×•×•××œ×” ×‘×™×˜×—×•×Ÿ',c:'#cc5500',i:'âš”ï¸'},
  kan:{n:'×›××Ÿ 11',c:'#3b82f6',i:'ğŸ™ï¸'},
  ch12:{n:'×¢×¨×•×¥ 12',c:'#C8102E',i:'ğŸ“º'},
  ch12b:{n:'×¢×¨×•×¥ 12 ×—×“×©×•×ª',c:'#e63946',i:'ğŸ“º'},
  ch13:{n:'×¢×¨×•×¥ 13',c:'#7C3AED',i:'ğŸ“¡'},
  ch14:{n:'×¢×¨×•×¥ 14',c:'#d97706',i:'ğŸ¦…'},
  mako:{n:'×××§×•',c:'#e11d48',i:'ğŸ¬'},
  maariv:{n:'××¢×¨×™×‘',c:'#0891B2',i:'ğŸ—ï¸'},
  idf:{n:'×“×•×‘×¨ ×¦×‘×',c:'#34d399',i:'ğŸª–'},
};

// source chips
function buildChips(){
  const el=document.getElementById('schips');
  const srcs=['all',...new Set(items.map(x=>x.source))];
  el.innerHTML='';
  srcs.forEach(id=>{
    const ch=id==='all'?{n:'×”×›×œ',c:'#dde1f0',i:'ğŸŒ'}:(CH[id]||{n:id,c:'#808080',i:'ğŸ“°'});
    const b=document.createElement('button');
    b.className='schip'+(id===cur?' on':'');
    b.textContent=ch.i+' '+ch.n;
    if(id===cur){b.style.background=ch.c+'18';b.style.borderColor=ch.c+'50';b.style.color=ch.c}
    b.onclick=()=>{cur=id;buildChips();buildList()};
    el.appendChild(b);
  });
}

// news list
const seen=new Set();
function buildList(){
  const el=document.getElementById('nlist');
  const list=cur==='all'?items:items.filter(x=>x.source===cur);
  if(!list.length){el.innerHTML='<div class="empty"><div style="font-size:40px">ğŸ“­</div><p style="margin-top:8px;font-size:13px">××™×Ÿ ×›×ª×‘×•×ª</p></div>';return}
  el.innerHTML='';
  const sep=document.createElement('div');sep.className='sep';
  const t=new Date().toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'});
  sep.innerHTML=`<span class="sep-l"></span><span>×¢×“×›×•×Ÿ ${t}</span><span class="sep-l"></span>`;
  el.appendChild(sep);
  list.forEach((item,idx)=>{
    const ch=CH[item.source]||{n:item.source,c:'#808080',i:'ğŸ“°'};
    const isNew=!seen.has(item.id);
    const isTop=idx===0&&cur==='all';
    const a=document.createElement('a');
    a.className='ncard'+(isTop?' top':isNew?' fresh':'');
    a.style.setProperty('--src-c',ch.c);
    a.href=item.link||'#';a.target='_blank';a.rel='noopener';
    a.style.animation=`fadeUp 0.18s ease ${Math.min(idx,16)*0.025}s both`;
    a.innerHTML=`<div class="cmeta"><span class="csrc" style="background:${ch.c}15;color:${ch.c}">${ch.i} ${ch.n}</span><div class="ctimerow"><span class="ctime">${item.timeAgo}</span>${isNew?'<span class="cnew">NEW</span>':''}</div></div><div class="ctitle">${item.title}</div>${item.desc?`<div class="cdesc">${item.desc}</div>`:''}`;
    el.appendChild(a);seen.add(item.id);
  });
}

async function loadNews(manual=false){
  if(busy&&!manual)return;busy=true;
  const btn=document.getElementById('rfbtn'),stxt=document.getElementById('stxt');
  if(manual){btn.disabled=true;btn.innerHTML='<span class="spin">âŸ³</span>'}
  try{
    const r=await fetch('/api/news?t='+Date.now());const d=await r.json();
    if(d.items&&d.items.length){
      items=d.items;
      const t=new Date(d.updated).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
      stxt.textContent='âœ“ '+t+' â€¢ '+d.total+' ×›×ª×‘×•×ª';
      buildChips();buildList();rotateTicker();
    }
  }catch(e){if(manual)stxt.textContent='×©×’×™××ª ×—×™×‘×•×¨'}
  if(manual){btn.disabled=false;btn.innerHTML='âŸ³ ×¨×¢× ×Ÿ'}
  busy=false;
}
function startA(){stopA();if(gs('auto'))timer=setInterval(()=>loadNews(),5000)}
function stopA(){if(timer){clearInterval(timer);timer=null}}
startA();

// sound
function setVol(v){vol=v/100}
document.getElementById('vol').oninput=e=>setVol(e.target.value);
function playAlarm(){
  if(!gs('sound'))return;
  try{const ctx=new(window.AudioContext||window.webkitAudioContext)();[[440,.13],[880,.13],[440,.13],[880,.13],[440,.13],[880,.13]].forEach(([f,d],i)=>{const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sawtooth';o.frequency.value=f;const t=ctx.currentTime+i*0.18;g.gain.setValueAtTime(vol*.4,t);g.gain.exponentialRampToValueAtTime(.001,t+d);o.start(t);o.stop(t+d)})}catch(e){}
}
function testS(){playAlarm();if(gs('vib')&&navigator.vibrate)navigator.vibrate([200,100,200])}
async function reqNotif(){if(!('Notification'in window)){alert('×”×“×¤×“×¤×Ÿ ×œ× ×ª×•××š ×‘×”×ª×¨××•×ª');return}const p=await Notification.requestPermission();alert(p==='granted'?'âœ… ×”×ª×¨××•×ª ×”×•×¤×¢×œ×•!':'âš ï¸ ×× × ××©×¨ ×”×¨×©××” ×‘×”×’×“×¨×•×ª')}

// oref
function setOref(state){
  const e=document.getElementById('oind');
  e.className='oind '+(state==='ok'?'ok':state==='alrt'?'alrt':'err');
  document.getElementById('ots').textContent=new Date().toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
}

async function checkAlerts(){
  try{
    const r=await fetch('/api/alerts?t='+Date.now());const txt=await r.text();
    oFails=0;
    if(!txt||txt.trim()===''||txt.trim()==='{}'){setOref('ok');clearAlert();return}
    const d=JSON.parse(txt);
    if(d&&d.data&&d.data.length>0){setOref('alrt');triggerAlert(d.data,d.title||'×™×¨×™ ×¨×§×˜×•×ª',d.data.join(','))}
    else{setOref('ok');clearAlert()}
  }catch(e){oFails++;if(oFails>=3)setOref('err')}
}

function triggerAlert(areas,type,key){
  const str=Array.isArray(areas)?areas.join(' â€¢ '):areas;
  hasAlert=true;
  document.getElementById('abox').classList.add('danger');
  document.getElementById('aicon').textContent='ğŸš¨';
  document.getElementById('astatus').textContent='××–×¢×§×” ×¤×¢×™×œ×”!';
  document.getElementById('aareas').textContent=str;
  document.getElementById('nbdot').classList.add('alrt');
  document.getElementById('astrip-a').textContent=str;
  document.getElementById('astrip').classList.add('show');
  if(key!==lastKey){
    lastKey=key;
    document.getElementById('oareas').textContent=str;
    document.getElementById('otype').textContent=type;
    document.getElementById('ovl').classList.add('show');
    playAlarm();
    if(gs('vib')&&navigator.vibrate)navigator.vibrate([500,150,500,150,500,150,500]);
    if('Notification'in window&&Notification.permission==='granted')
      new Notification('ğŸš¨ ××–×¢×§×” â€” '+type,{body:str,icon:'/icon-192.png',requireInteraction:true});
  }
}
function clearAlert(){if(!hasAlert)return;hasAlert=false;lastKey='';document.getElementById('abox').classList.remove('danger');document.getElementById('aicon').textContent='âœ…';document.getElementById('astatus').textContent='××™×Ÿ ××–×¢×§×•×ª ×›×¨×’×¢';document.getElementById('aareas').textContent='';document.getElementById('nbdot').classList.remove('alrt');document.getElementById('astrip').classList.remove('show')}
function closeOvl(){document.getElementById('ovl').classList.remove('show')}

async function loadHist(){
  try{
    const r=await fetch('/api/alerts/history');const d=await r.json();const el=document.getElementById('hlist');
    if(!Array.isArray(d)||!d.length){el.innerHTML='<div style="font-size:11px;color:var(--text3);padding:8px 0">××™×Ÿ ××–×¢×§×•×ª ×”×™×•×</div>';return}
    el.innerHTML=d.slice(0,12).map(a=>`<div class="hcard"><div><div class="hcity">${a.cities||(Array.isArray(a.data)?a.data.join(', '):'')||'â€”'}</div><div class="htype">${a.alertHeader||a.title||''}</div></div><div class="htime">${a.alertDate?new Date(a.alertDate).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'}):''}</div></div>`).join('');
  }catch(e){}
}

if('serviceWorker'in navigator)navigator.serviceWorker.register('/sw.js');
loadNews(true);
checkAlerts();setInterval(checkAlerts,5000);
loadHist();setInterval(loadHist,30000);
</script>
</body>
</html>
