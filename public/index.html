<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0a0a0f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="×—×“×©×•×ª LIVE">
<link rel="manifest" href="/manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<title>×—×“×©×•×ª ×™×©×¨××œ LIVE</title>
<style>
:root{--red:#ef4444;--red2:#b91c1c;--bg:#08080f;--bg2:#0f0f1a;--bg3:#161625;--card:#12121e;--border:rgba(255,255,255,0.07);--text:#f0f0f5;--text2:#8888aa;--text3:#44445a;--green:#22c55e}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{font-family:'Heebo',sans-serif;background:var(--bg);color:var(--text);max-width:480px;margin:0 auto;padding-bottom:74px;min-height:100vh;-webkit-font-smoothing:antialiased;overflow-x:hidden}
::-webkit-scrollbar{width:0}
body::before{content:'';position:fixed;top:-200px;right:-200px;width:500px;height:500px;border-radius:50%;background:radial-gradient(circle,rgba(239,68,68,0.06) 0%,transparent 70%);pointer-events:none;z-index:0;animation:bgpulse 4s ease-in-out infinite}
body::after{content:'';position:fixed;bottom:-200px;left:-200px;width:400px;height:400px;border-radius:50%;background:radial-gradient(circle,rgba(37,99,235,0.05) 0%,transparent 70%);pointer-events:none;z-index:0}
@keyframes bgpulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.2);opacity:0.6}}
#header{position:sticky;top:0;z-index:50;background:rgba(8,8,15,0.95);backdrop-filter:blur(20px);border-bottom:1px solid rgba(239,68,68,0.2)}
.h-top{display:flex;justify-content:space-between;align-items:center;padding:10px 16px 8px}
.logo{display:flex;align-items:center;gap:8px}
.logo-text{font-size:18px;font-weight:900;background:linear-gradient(90deg,#fff 0%,#f87171 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.badge-live{background:var(--red);border-radius:4px;padding:2px 6px;font-size:9px;font-weight:900;color:#fff;letter-spacing:1.5px;animation:blink 1s infinite}
.badge-war{background:linear-gradient(90deg,#7f1d1d,#b91c1c);border:1px solid rgba(239,68,68,0.4);border-radius:4px;padding:2px 7px;font-size:9px;font-weight:900;color:#ffd700}
.clock{text-align:left}
#clock-time{font-size:18px;font-weight:900;color:#fbbf24;font-variant-numeric:tabular-nums;letter-spacing:1px}
#clock-date{font-size:10px;color:var(--text3)}
#alert-strip{display:none;padding:8px 16px;background:linear-gradient(90deg,rgba(239,68,68,0.2),rgba(185,28,28,0.15));border-bottom:1px solid rgba(239,68,68,0.3);animation:alertstrip 1s ease-in-out infinite}
#alert-strip.show{display:flex;align-items:center;gap:8px}
.strip-icon{font-size:18px;animation:shake 0.5s infinite}
.strip-text{font-size:12px;font-weight:800;color:#fca5a5;flex:1}
.strip-areas{font-size:11px;color:#fecaca;margin-top:1px}
@keyframes alertstrip{0%,100%{background:linear-gradient(90deg,rgba(239,68,68,0.2),rgba(185,28,28,0.15))}50%{background:linear-gradient(90deg,rgba(239,68,68,0.35),rgba(185,28,28,0.3))}}
@keyframes shake{0%,100%{transform:rotate(0)}25%{transform:rotate(-10deg)}75%{transform:rotate(10deg)}}
.ticker{display:flex;align-items:center;gap:8px;padding:5px 16px;background:rgba(0,0,0,0.3);border-bottom:1px solid var(--border);overflow:hidden}
.ticker-dot{width:7px;height:7px;border-radius:50%;background:var(--red);box-shadow:0 0 8px var(--red);animation:blink 1s infinite;flex-shrink:0}
#ticker-text{font-size:11px;color:#fcd34d;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;transition:opacity 0.4s}
.tabs{display:flex}
.tab-btn{flex:1;padding:8px 0;border:none;cursor:pointer;background:transparent;font-size:11px;font-weight:700;color:var(--text3);border-bottom:2px solid transparent;transition:all 0.2s;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:4px}
.tab-btn.active{color:#f87171;border-bottom-color:var(--red);font-weight:900}
.panel{display:none}.panel.active{display:block}
#status-bar{display:flex;align-items:center;justify-content:space-between;padding:6px 14px;background:rgba(239,68,68,0.05);border-bottom:1px solid rgba(239,68,68,0.1)}
#status-text{font-size:10px;color:#f87171;font-weight:700;flex:1}
#refresh-btn{padding:4px 11px;border-radius:20px;background:var(--red);border:none;color:#fff;font-size:10px;cursor:pointer;font-weight:900;font-family:inherit}
.src-scroll{display:flex;gap:5px;padding:8px 14px;overflow-x:auto;scrollbar-width:none;border-bottom:1px solid var(--border)}
.src-btn{padding:4px 11px;border-radius:20px;border:1px solid var(--border);cursor:pointer;background:var(--bg3);color:var(--text2);font-size:10px;white-space:nowrap;flex-shrink:0;font-family:inherit;font-weight:700}
#breaking-banner{display:none;margin:10px 12px 0;border-radius:12px;overflow:hidden}
#breaking-banner.show{display:block}
.breaking-inner{background:linear-gradient(135deg,rgba(239,68,68,0.15),rgba(185,28,28,0.1));border:1px solid rgba(239,68,68,0.3);border-radius:12px;padding:10px 14px;display:flex;align-items:center;gap:10px}
.breaking-tag{background:var(--red);font-size:9px;font-weight:900;padding:2px 7px;border-radius:4px;color:#fff;white-space:nowrap;letter-spacing:1px;animation:blink 1s infinite}
.breaking-text{font-size:12px;font-weight:700;color:#fca5a5;flex:1;line-height:1.4}
#news-list{padding:10px 12px}
.news-card{display:block;text-decoration:none;color:inherit;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px 13px 12px 16px;margin-bottom:7px;position:relative;overflow:hidden;transition:transform 0.12s}
.news-card:active{transform:scale(0.985)}
.news-card.new-item{border-color:rgba(34,197,94,0.3)}
.news-stripe{position:absolute;top:0;right:0;bottom:0;width:3px}
.card-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;gap:6px}
.src-chip{font-size:10px;font-weight:800;padding:2px 8px;border-radius:6px;white-space:nowrap}
.time-ago{font-size:10px;color:var(--text3);white-space:nowrap;display:flex;align-items:center;gap:3px}
.new-dot{width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 5px var(--green)}
.card-title{font-size:13.5px;font-weight:700;line-height:1.5;color:#e8e8f0}
.card-desc{font-size:11.5px;color:var(--text2);line-height:1.4;margin-top:4px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.empty-state{text-align:center;padding:48px 20px;color:var(--text3)}
.alerts-wrap{padding:14px}
.oref-status{display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--card);border:1px solid var(--border);border-radius:12px;margin-bottom:12px}
.oref-dot{width:10px;height:10px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:pulse 2s infinite;flex-shrink:0}
.oref-dot.red{background:var(--red);box-shadow:0 0 8px var(--red)}
.oref-dot.grey{background:#475569;box-shadow:none;animation:none}
.oref-info{flex:1}
.oref-title{font-size:12px;font-weight:800;color:var(--text)}
.oref-sub{font-size:10px;color:var(--text3);margin-top:1px}
#oref-last-check{font-size:9px;color:var(--text3)}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.4)}}
#alert-box{border-radius:16px;padding:20px;margin-bottom:12px;text-align:center;border:2px solid var(--green);background:rgba(34,197,94,0.06);transition:all 0.3s}
#alert-box.danger{background:linear-gradient(135deg,rgba(127,29,29,0.7),rgba(153,27,27,0.45));border-color:var(--red);animation:pulseAlert 1s infinite}
#alert-emoji{font-size:46px;margin-bottom:4px}
#alert-status{font-size:17px;font-weight:900}
#alert-areas{font-size:13px;color:#fecaca;margin-top:8px;line-height:2;font-weight:700}
.alert-meta{font-size:10px;color:var(--text3);margin-top:6px;display:flex;align-items:center;justify-content:center;gap:6px}
.oref-badge{background:rgba(34,197,94,0.1);border:1px solid rgba(34,197,94,0.3);border-radius:4px;padding:1px 6px;font-size:9px;color:var(--green);font-weight:700}
.safety-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px}
.safety-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center}
.hist-title{font-size:11px;font-weight:800;color:var(--text3);margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px}
.hist-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:10px 13px;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}
.settings-wrap{padding:14px}
.s-section{margin-bottom:18px}
.s-title{font-size:10px;font-weight:900;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.s-card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.s-row{display:flex;align-items:center;justify-content:space-between;padding:13px 15px;border-bottom:1px solid var(--border)}
.s-row:last-child{border-bottom:none}
.s-label{font-size:13px;font-weight:700;color:var(--text)}
.s-sub{font-size:10px;color:var(--text3);margin-top:1px}
.toggle{width:44px;height:24px;border-radius:12px;background:var(--bg3);border:2px solid var(--border);cursor:pointer;position:relative;transition:all 0.2s;flex-shrink:0}
.toggle.on{background:var(--red);border-color:var(--red)}
.toggle::after{content:'';position:absolute;top:2px;right:2px;width:16px;height:16px;border-radius:50%;background:#fff;transition:all 0.2s}
.toggle.on::after{right:22px}
.test-btn{width:100%;padding:11px;border-radius:10px;background:rgba(239,68,68,0.12);border:1px solid rgba(239,68,68,0.25);color:#f87171;font-size:12px;font-weight:700;cursor:pointer;font-family:inherit;margin-top:6px}
.notif-btn{width:100%;padding:12px;border-radius:12px;background:var(--red);border:none;color:#fff;font-size:13px;font-weight:900;cursor:pointer;font-family:inherit;margin-bottom:8px}
.vol-row{flex-direction:column;align-items:flex-start;gap:8px}
.vol-slider{width:100%;accent-color:var(--red);cursor:pointer}
#alert-overlay{display:none;position:fixed;inset:0;z-index:999;background:rgba(0,0,0,0.93);align-items:center;justify-content:center}
#alert-overlay.show{display:flex}
.alert-modal{background:linear-gradient(135deg,#7f1d1d,#991b1b);border:3px solid var(--red);border-radius:22px;padding:28px 24px;text-align:center;width:88%;max-width:340px;box-shadow:0 0 80px rgba(239,68,68,0.7);animation:pulseAlert 1s infinite}
.alert-close{margin-top:16px;padding:9px 26px;border-radius:30px;border:2px solid var(--red);background:transparent;color:#fca5a5;font-size:13px;cursor:pointer;font-weight:900;font-family:inherit}
#bottom-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;z-index:100;background:rgba(8,8,15,0.97);border-top:1px solid var(--border);display:flex;backdrop-filter:blur(20px);padding-bottom:env(safe-area-inset-bottom)}
.nav-btn{flex:1;padding:10px 0;border:none;cursor:pointer;background:transparent;font-size:9px;font-weight:700;color:var(--text3);display:flex;flex-direction:column;align-items:center;gap:3px;font-family:inherit;position:relative;transition:color 0.15s}
.nav-btn.active{color:#f87171;font-weight:900}
.nav-icon{font-size:21px;line-height:1}
.nav-dot{position:absolute;top:8px;right:calc(50% - 14px);width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 5px var(--green)}
.nav-dot.red{background:var(--red);box-shadow:0 0 6px var(--red);animation:blink 0.8s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.2}}
@keyframes pulseAlert{0%,100%{box-shadow:0 0 30px rgba(239,68,68,0.5)}50%{box-shadow:0 0 70px rgba(239,68,68,0.9)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes spin{to{transform:rotate(360deg)}}
.spin{display:inline-block;animation:spin 0.7s linear infinite}
</style>
</head>
<body>
<div id="alert-overlay">
  <div class="alert-modal">
    <div style="font-size:60px">ğŸš¨</div>
    <div style="font-size:26px;font-weight:900;color:#fca5a5;margin-top:4px">××–×¢×§×”!</div>
    <div id="overlay-type" style="font-size:16px;font-weight:700;color:#fff;margin-top:5px"></div>
    <div id="overlay-areas" style="font-size:14px;color:#fecaca;margin-top:10px;line-height:2;font-weight:700"></div>
    <div style="margin-top:12px;font-size:12px;color:#f87171;font-weight:800">×”×™×›× ×¡×• ×œ××¨×—×‘ ××•×’×Ÿ ××™×™×“×™×ª!</div>
    <button class="alert-close" onclick="dismissOverlay()">×”×‘× ×ª×™</button>
  </div>
</div>
<div id="header">
  <div class="h-top">
    <div class="logo">
      <span style="font-size:20px">ğŸ‡®ğŸ‡±</span>
      <span class="logo-text">×—×“×©×•×ª LIVE</span>
      <span class="badge-live">LIVE</span>
      <span class="badge-war">××œ×—××”</span>
    </div>
    <div class="clock">
      <div id="clock-time">00:00</div>
      <div id="clock-date"></div>
    </div>
  </div>
  <div id="alert-strip">
    <span class="strip-icon">ğŸš¨</span>
    <div><div class="strip-text">××–×¢×§×” ×¤×¢×™×œ×”!</div><div class="strip-areas" id="strip-areas"></div></div>
  </div>
  <div class="ticker"><div class="ticker-dot"></div><span id="ticker-text">××ª×—×‘×¨ ×œ×¢×¨×•×¦×™×...</span></div>
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('news',this)">ğŸ“° ×—×“×©×•×ª</button>
    <button class="tab-btn" onclick="switchTab('alerts',this)">ğŸš¨ ××–×¢×§×•×ª</button>
    <button class="tab-btn" onclick="switchTab('settings',this)">âš™ï¸ ×”×’×“×¨×•×ª</button>
  </div>
</div>
<div id="panel-news" class="panel active">
  <div id="status-bar">
    <span id="status-text"><span class="spin">âŸ³</span> ××ª×—×‘×¨...</span>
    <button id="refresh-btn" onclick="loadNews(true)">âŸ³ ×¨×¢× ×Ÿ</button>
  </div>
  <div class="src-scroll" id="src-tabs"></div>
  <div id="breaking-banner"><div class="breaking-inner"><span class="breaking-tag">××‘×–×§</span><span class="breaking-text" id="breaking-text"></span></div></div>
  <div id="news-list"><div class="empty-state"><div style="font-size:44px">ğŸ“¡</div><p style="margin-top:8px">×˜×•×¢×Ÿ ×—×“×©×•×ª...</p></div></div>
</div>
<div id="panel-alerts" class="panel">
  <div class="alerts-wrap">
    <div class="oref-status">
      <div class="oref-dot grey" id="oref-dot"></div>
      <div class="oref-info">
        <div class="oref-title">×¤×™×§×•×“ ×”×¢×•×¨×£</div>
        <div class="oref-sub">×‘×“×™×§×” ×›×œ 5 ×©× ×™×•×ª â€¢ oref.org.il</div>
      </div>
      <div id="oref-last-check">--:--</div>
    </div>
    <div id="alert-box">
      <div id="alert-emoji">âœ…</div>
      <div id="alert-status" style="color:var(--green)">××™×Ÿ ××–×¢×§×•×ª ×›×¨×’×¢</div>
      <div id="alert-areas"></div>
      <div class="alert-meta"><span>××ª×¢×“×›×Ÿ ×›×œ 5 ×©× ×™×•×ª</span><span class="oref-badge">oref.org.il</span></div>
    </div>
    <div class="safety-grid">
      <div class="safety-card"><div style="font-size:24px">ğŸƒ</div><div style="font-size:11px;color:#94a3b8;margin-top:3px">×‘× ×™×™×Ÿ ×¨×’×™×œ</div><div style="font-size:14px;font-weight:900;color:#fbbf24;margin-top:3px">90 ×©× '</div></div>
      <div class="safety-card"><div style="font-size:24px">ğŸ </div><div style="font-size:11px;color:#94a3b8;margin-top:3px">×‘×™×ª ×¤×¨×˜×™</div><div style="font-size:14px;font-weight:900;color:#fb923c;margin-top:3px">60 ×©× '</div></div>
      <div class="safety-card"><div style="font-size:24px">ğŸŒ³</div><div style="font-size:11px;color:#94a3b8;margin-top:3px">×©×˜×— ×¤×ª×•×—</div><div style="font-size:14px;font-weight:900;color:#f87171;margin-top:3px">30 ×©× '</div></div>
      <div class="safety-card"><div style="font-size:24px">ğŸš—</div><div style="font-size:11px;color:#94a3b8;margin-top:3px">×¨×›×‘</div><div style="font-size:14px;font-weight:900;color:#c084fc;margin-top:3px">×¢×¦×•×¨ ×•×©×›×‘</div></div>
    </div>
    <div class="hist-title">××–×¢×§×•×ª ××—×¨×•× ×•×ª</div>
    <div id="alert-history"><div style="color:#475569;text-align:center;padding:14px;font-size:12px">×˜×•×¢×Ÿ...</div></div>
  </div>
</div>
<div id="panel-settings" class="panel">
  <div class="settings-wrap">
    <div class="s-section">
      <div class="s-title">×”×ª×¨××•×ª</div>
      <button class="notif-btn" onclick="requestNotif()">×”×¤×¢×œ ×”×ª×¨××•×ª ğŸ””</button>
      <div class="s-card">
        <div class="s-row"><div><div class="s-label">×¦×œ×™×œ ××–×¢×§×”</div><div class="s-sub">×¦×¤×™×¨×” ×›×©×™×© ××–×¢×§×”</div></div><div class="toggle on" id="t-sound" onclick="tog('sound')"></div></div>
        <div class="s-row"><div><div class="s-label">×•×™×‘×¨×¦×™×”</div><div class="s-sub">×¨×˜×˜ ×‘××–×¢×§×”</div></div><div class="toggle on" id="t-vibrate" onclick="tog('vibrate')"></div></div>
        <div class="s-row vol-row"><div class="s-label">×¢×•×¦××ª ×§×•×œ</div><input type="range" min="0" max="100" value="80" class="vol-slider" id="vol-slider" oninput="setVol(this.value)"></div>
      </div>
      <button class="test-btn" onclick="testSound()">ğŸ”Š ×‘×“×•×§ ×¦×œ×™×œ</button>
    </div>
    <div class="s-section">
      <div class="s-title">×¢×“×›×•× ×™×</div>
      <div class="s-card">
        <div class="s-row"><div><div class="s-label">×¨×¢× ×•×Ÿ ××•×˜×•××˜×™</div><div class="s-sub">×—×“×©×•×ª ×•×’× ××–×¢×§×•×ª ×›×œ 5 ×©× ×™×•×ª</div></div><div class="toggle on" id="t-auto" onclick="tog('auto')"></div></div>
      </div>
    </div>
    <div style="text-align:center;padding:14px;font-size:10px;color:var(--text3)">×—×“×©×•×ª ×™×©×¨××œ LIVE v2.1<br><span style="color:#475569">ynet â€¢ ×•×•××œ×” â€¢ ×›××Ÿ â€¢ ×¢×¨×•×¥ 13 â€¢ ×¢×¨×•×¥ 14 â€¢ ××¢×¨×™×‘ â€¢ ×“×•×‘×¨ ×¦×‘×</span></div>
  </div>
</div>
<div id="bottom-nav">
  <button class="nav-btn active" id="nav-news" onclick="switchTab('news',null)"><span class="nav-icon">ğŸ“°</span>×—×“×©×•×ª</button>
  <button class="nav-btn" id="nav-alerts" onclick="switchTab('alerts',null)"><div class="nav-dot" id="alert-dot"></div><span class="nav-icon">ğŸš¨</span>××–×¢×§×•×ª</button>
  <button class="nav-btn" id="nav-settings" onclick="switchTab('settings',null)"><span class="nav-icon">âš™ï¸</span>×”×’×“×¨×•×ª</button>
</div>
<script>
const S=JSON.parse(localStorage.getItem('nset')||'{}');
const SD={sound:true,vibrate:true,auto:true};
const gs=k=>k in S?S[k]:SD[k];
const ss=(k,v)=>{S[k]=v;localStorage.setItem('nset',JSON.stringify(S))};
function tog(k){const v=!gs(k);ss(k,v);const el=document.getElementById('t-'+k);if(el)v?el.classList.add('on'):el.classList.remove('on');if(k==='auto')v?startAuto():stopAuto()}
function initToggles(){['sound','vibrate','auto'].forEach(k=>{const el=document.getElementById('t-'+k);if(el)gs(k)?el.classList.add('on'):el.classList.remove('on')})}
initToggles();
let allItems=[],currentSrc='all',hasAlert=false,tickIdx=0,autoTimer=null,vol=0.8,lastAlertKey='',orefFails=0,loading=false;
function tick(){const n=new Date();document.getElementById('clock-time').textContent=n.toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'});document.getElementById('clock-date').textContent=n.toLocaleDateString('he-IL',{day:'numeric',month:'long'})}
tick();setInterval(tick,1000);
function rotateTicker(){if(!allItems.length)return;const el=document.getElementById('ticker-text');el.style.opacity='0';setTimeout(()=>{const item=allItems[tickIdx%Math.min(allItems.length,50)];if(item)el.textContent=item.sourceIcon+' '+item.title;el.style.opacity='1';tickIdx++},400)}
setInterval(rotateTicker,5000);
function switchTab(tab,btn){document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));document.getElementById('panel-'+tab).classList.add('active');if(btn)btn.classList.add('active');const m={news:'nav-news',alerts:'nav-alerts',settings:'nav-settings'};if(m[tab])document.getElementById(m[tab]).classList.add('active')}
const CH={ynet:{name:'ynet',color:'#E8001E',icon:'ğŸ“°'},ynet_war:{name:'ynet ××œ×—××”',color:'#b30000',icon:'ğŸš¨'},walla:{name:'×•×•××œ×”',color:'#FF6B00',icon:'ğŸ”¥'},walla_war:{name:'×•×•××œ×” ×‘×™×˜×—×•×Ÿ',color:'#cc5500',icon:'âš”ï¸'},maariv:{name:'××¢×¨×™×‘',color:'#0891B2',icon:'ğŸ—ï¸'},kan:{name:'×›××Ÿ 11',color:'#2563EB',icon:'ğŸ™ï¸'},ch13:{name:'×¢×¨×•×¥ 13',color:'#7C3AED',icon:'ğŸ“¡'},ch14:{name:'×¢×¨×•×¥ 14',color:'#d97706',icon:'ğŸ¦…'},idf:{name:'×“×•×‘×¨ ×¦×‘×',color:'#166534',icon:'ğŸª–'}};
function renderSrcTabs(){const el=document.getElementById('src-tabs');const sources=['all',...new Set(allItems.map(i=>i.source))];el.innerHTML='';sources.forEach(id=>{const ch=id==='all'?{name:'ğŸŒ ×”×›×œ',color:'#fbbf24',icon:''}:(CH[id]||{name:id,color:'#6b7280',icon:'ğŸ“°'});const b=document.createElement('button');b.className='src-btn'+(id===currentSrc?' active':'');b.textContent=(ch.icon?ch.icon+' ':'')+ch.name;if(id===currentSrc){b.style.background=ch.color+'22';b.style.borderColor=ch.color+'55';b.style.color=ch.color;}b.onclick=()=>{currentSrc=id;renderSrcTabs();renderList()};el.appendChild(b)})}
const seenIds=new Set();
function renderList(){const list=document.getElementById('news-list');const filtered=currentSrc==='all'?allItems:allItems.filter(n=>n.source===currentSrc);if(!filtered.length){list.innerHTML='<div class="empty-state"><div style="font-size:44px">ğŸ“¡</div><p style="margin-top:8px">××™×Ÿ ×›×ª×‘×•×ª</p></div>';return}list.innerHTML='';filtered.forEach((item,idx)=>{const ch=CH[item.source]||{name:item.source,color:'#6b7280',icon:'ğŸ“°'};const isNew=!seenIds.has(item.id);const a=document.createElement('a');a.className='news-card'+(isNew?' new-item':'');a.href=item.link||'#';a.target='_blank';a.rel='noopener';a.style.cssText=`animation:fadeUp 0.18s ease ${Math.min(idx,12)*0.025}s both`;a.innerHTML=`<div class="news-stripe" style="background:${ch.color}"></div><div class="card-top"><span class="src-chip" style="background:${ch.color}18;border:1px solid ${ch.color}40;color:${ch.color}">${ch.icon} ${ch.name}</span><span class="time-ago">${item.timeAgo}${isNew?'<span class="new-dot"></span>':''}</span></div><div class="card-title">${item.title}</div>${item.desc?`<div class="card-desc">${item.desc}</div>`:''}`;list.appendChild(a);seenIds.add(item.id)});if(allItems.length>0){document.getElementById('breaking-text').textContent=allItems[0].sourceIcon+' '+allItems[0].title;document.getElementById('breaking-banner').classList.add('show')}}
async function loadNews(manual=false){if(loading&&!manual)return;loading=true;const btn=document.getElementById('refresh-btn');const status=document.getElementById('status-text');if(manual){btn.disabled=true;btn.innerHTML='<span class="spin">âŸ³</span>'}try{const res=await fetch('/api/news?t='+Date.now());const data=await res.json();if(data.items&&data.items.length>0){allItems=data.items;const t=new Date(data.updated).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'});status.textContent='âœ“ '+t+' â€¢ '+data.total+' ×›×ª×‘×•×ª';renderSrcTabs();renderList();rotateTicker()}}catch(e){if(manual)status.textContent='×©×’×™××ª ×—×™×‘×•×¨'}if(manual){btn.disabled=false;btn.innerHTML='âŸ³ ×¨×¢× ×Ÿ'}loading=false}
function startAuto(){stopAuto();if(gs('auto'))autoTimer=setInterval(()=>loadNews(false),5000)}
function stopAuto(){if(autoTimer){clearInterval(autoTimer);autoTimer=null}}
startAuto();
function setVol(v){vol=v/100}
document.getElementById('vol-slider').oninput=e=>setVol(e.target.value);
function playAlert(){if(!gs('sound'))return;try{const ctx=new(window.AudioContext||window.webkitAudioContext)();[[440,.12],[880,.12],[440,.12],[880,.12],[440,.12]].forEach(([f,d],i)=>{const o=ctx.createOscillator(),g=ctx.createGain();o.connect(g);g.connect(ctx.destination);o.type='sawtooth';o.frequency.value=f;const t=ctx.currentTime+i*0.17;g.gain.setValueAtTime(vol*.4,t);g.gain.exponentialRampToValueAtTime(.001,t+d);o.start(t);o.stop(t+d)})}catch(e){}}
function testSound(){playAlert();if(gs('vibrate')&&navigator.vibrate)navigator.vibrate([200,100,200])}
async function requestNotif(){if(!('Notification'in window)){alert('×”×“×¤×“×¤×Ÿ ×œ× ×ª×•××š ×‘×”×ª×¨××•×ª');return}const p=await Notification.requestPermission();if(p==='granted')alert('×”×ª×¨××•×ª ×”×•×¤×¢×œ×•!');else alert('×× × ××©×¨ ×”×ª×¨××•×ª ×‘×”×’×“×¨×•×ª')}
function setOrefStatus(ok){const dot=document.getElementById('oref-dot');dot.className=ok?'oref-dot':'oref-dot grey';document.getElementById('oref-last-check').textContent=new Date().toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit',second:'2-digit'})}
async function checkAlerts(){try{const res=await fetch('/api/alerts?t='+Date.now());const text=await res.text();orefFails=0;if(!text||text.trim()===''||text.trim()==='{}'){setOrefStatus(true);clearAlert();return}const data=JSON.parse(text);if(data&&data.data&&data.data.length>0){setOrefStatus(true);triggerAlert(data.data,data.title||'×™×¨×™ ×¨×§×˜×•×ª',data.data.join(','))}else{setOrefStatus(true);clearAlert()}}catch(e){orefFails++;if(orefFails>=3)setOrefStatus(false)}}
function triggerAlert(areas,type,key){const str=Array.isArray(areas)?areas.join(' â€¢ '):areas;hasAlert=true;document.getElementById('alert-box').classList.add('danger');document.getElementById('alert-emoji').textContent='ğŸš¨';document.getElementById('alert-status').textContent='××–×¢×§×” ×¤×¢×™×œ×”!';document.getElementById('alert-status').style.color='#fca5a5';document.getElementById('alert-areas').textContent=str;document.getElementById('alert-dot').classList.add('red');document.getElementById('oref-dot').className='oref-dot red';document.getElementById('strip-areas').textContent=str;document.getElementById('alert-strip').classList.add('show');if(key!==lastAlertKey){lastAlertKey=key;document.getElementById('overlay-areas').textContent=str;document.getElementById('overlay-type').textContent=type;document.getElementById('alert-overlay').classList.add('show');playAlert();if(gs('vibrate')&&navigator.vibrate)navigator.vibrate([400,100,400,100,400,100,400]);if('Notification'in window&&Notification.permission==='granted')new Notification('××–×¢×§×”! '+type,{body:str,icon:'/icon-192.png'})}}
function clearAlert(){if(!hasAlert)return;hasAlert=false;lastAlertKey='';document.getElementById('alert-box').classList.remove('danger');document.getElementById('alert-emoji').textContent='âœ…';document.getElementById('alert-status').textContent='××™×Ÿ ××–×¢×§×•×ª ×›×¨×’×¢';document.getElementById('alert-status').style.color='var(--green)';document.getElementById('alert-areas').textContent='';document.getElementById('alert-dot').classList.remove('red');document.getElementById('alert-strip').classList.remove('show');document.getElementById('oref-dot').className='oref-dot'}
function dismissOverlay(){document.getElementById('alert-overlay').classList.remove('show')}
async function loadHistory(){try{const res=await fetch('/api/alerts/history');const data=await res.json();if(!Array.isArray(data)||!data.length){document.getElementById('alert-history').innerHTML='<div style="color:#475569;text-align:center;padding:12px;font-size:12px">××™×Ÿ ××–×¢×§×•×ª ×”×™×•×</div>';return}document.getElementById('alert-history').innerHTML=data.slice(0,10).map(a=>`<div class="hist-card"><div><div style="font-size:12px;font-weight:700;color:#e2e8f0">${a.cities||(Array.isArray(a.data)?a.data.join(', '):'')||''}</div><div style="font-size:10px;color:#64748b">${a.alertHeader||a.title||''}</div></div><div style="text-align:left"><div style="font-size:11px;font-weight:700;color:#fbbf24">${a.alertDate?new Date(a.alertDate).toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'}):''}</div><div style="font-size:9px;color:var(--green)">×”×¡×ª×™×™××”</div></div></div>`).join('')}catch(e){}}
if('serviceWorker'in navigator)navigator.serviceWorker.register('/sw.js');
loadNews(true);
checkAlerts();setInterval(checkAlerts,5000);
loadHistory();setInterval(loadHistory,30000);
</script>
</body>
</html>
